<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cover Brain - Plateforme de Répétiteurs</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <style>
        /* ===== RESET & VARIABLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4a6fa5;
            --secondary: #ffc107;
            --dark: #343a40;
            --light: #f5f7fa;
            --success: #28a745;
            --danger: #dc3545;
            --info: #17a2b8;
            --warning: #ffc107;
            --gradient-primary: linear-gradient(135deg, #4a6fa5 0%, #2c5282 100%);
            --gradient-secondary: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            --gradient-success: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
            --gradient-danger: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        body {
            background-color: var(--light);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .hidden {
            display: none !important;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        /* ===== HEADER ===== */
        header {
            background: var(--gradient-primary);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo span {
            color: var(--secondary);
        }

        /* ===== NAVIGATION ===== */
        .main-nav {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .nav-tab {
            padding: 12px 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            color: white;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .nav-tab:hover::before {
            left: 100%;
        }

        .nav-tab:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .nav-tab.active {
            background: var(--gradient-secondary);
            color: #333;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
        }

        .more-dropdown {
            position: relative;
        }

        .more-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-width: 220px;
            display: none;
            z-index: 1000;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .more-menu.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .more-menu a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 20px;
            color: var(--dark);
            text-decoration: none;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s ease;
        }

        .more-menu a:hover {
            background: var(--gradient-primary);
            color: white;
            transform: translateX(5px);
        }

        .more-menu a:last-child {
            border-bottom: none;
        }

        .user-info {
            display: flex;
            align-items: center;
            background: rgba(255,255,255,0.15);
            padding: 10px 18px;
            border-radius: 25px;
            gap: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .notification-badge {
            background: var(--gradient-danger);
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            position: absolute;
            top: -6px;
            right: -6px;
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.4);
        }

        /* ===== HERO SECTION ===== */
        .hero {
            background: linear-gradient(rgba(74, 111, 165, 0.85), rgba(74, 111, 165, 0.95)), url('https://images.unsplash.com/photo-1523240795612-9a054b0db644?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            padding: 6rem 0;
            text-align: center;
            position: relative;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .hero p {
            font-size: 1.3rem;
            max-width: 700px;
            margin: 0 auto 3rem;
            opacity: 0.95;
        }

        /* ===== BUTTONS MODERNES ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: var(--gradient-secondary);
            color: #333;
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 193, 7, 0.4);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 15px rgba(74, 111, 165, 0.3);
        }

        .btn-primary:hover {
            box-shadow: 0 8px 25px rgba(74, 111, 165, 0.4);
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-success:hover {
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }

        .btn-danger {
            background: var(--gradient-danger);
            color: white;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .btn-danger:hover {
            box-shadow: 0 8px 25px rgba(220, 53, 69, 0.4);
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        }

        .btn-whatsapp:hover {
            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.4);
        }

        .btn-sm {
            padding: 10px 20px;
            font-size: 0.9rem;
            border-radius: 10px;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            box-shadow: none;
        }

        .btn-outline:hover {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 15px rgba(74, 111, 165, 0.3);
        }

        /* ===== SECTIONS ===== */
        .section {
            padding: 4rem 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 3rem;
            color: var(--primary);
            position: relative;
            font-size: 2.2rem;
            font-weight: 700;
        }

        .section-title::after {
            content: '';
            display: block;
            width: 100px;
            height: 5px;
            background: var(--gradient-secondary);
            margin: 20px auto;
            border-radius: 3px;
        }

        /* ===== SEARCH SECTION ===== */
        .search-section {
            background: linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%);
            padding: 4rem 0;
        }

        .search-form {
            display: flex;
            max-width: 800px;
            margin: 0 auto;
            gap: 0;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            border-radius: 15px;
            overflow: hidden;
        }

        .search-input {
            flex: 1;
            padding: 18px 24px;
            border: none;
            font-size: 1.1rem;
            background: white;
        }

        .search-input:focus {
            outline: none;
            box-shadow: inset 0 0 0 2px var(--primary);
        }

        .search-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 0 30px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            background: var(--primary);
            transform: none;
        }

        /* ===== CARDS ===== */
        .teacher-card, .student-card, .comment-card, .admin-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            padding: 2.5rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            border-left: 6px solid var(--primary);
            position: relative;
            overflow: hidden;
        }

        .teacher-card::before, .student-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
        }

        .admin-card {
            border-left-color: var(--danger);
        }

        .admin-card::before {
            background: var(--gradient-danger);
        }

        .teacher-card:hover, .student-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .teacher-info, .student-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px;
            border-radius: 10px;
            transition: background 0.3s ease;
        }

        .info-item:hover {
            background: #f8f9fa;
        }

        .info-item i {
            color: var(--primary);
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        .courses-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 1.5rem 0;
        }

        .course-tag {
            background: var(--gradient-primary);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(74, 111, 165, 0.3);
        }

        .teacher-actions, .student-actions {
            display: flex;
            gap: 15px;
            margin-top: 2rem;
        }

        .teacher-actions .btn, .student-actions .btn {
            flex: 1;
            justify-content: center;
            border-radius: 12px;
        }

        .availability-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .available {
            background: var(--gradient-success);
            color: white;
        }

        .unavailable {
            background: var(--gradient-danger);
            color: white;
        }

        /* ===== ADMIN PANEL ===== */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            border-left: 6px solid var(--primary);
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .stat-label {
            color: #6c757d;
            font-weight: 500;
            font-size: 1.1rem;
        }

        .admin-section {
            background: white;
            border-radius: 16px;
            padding: 2.5rem;
            margin-bottom: 2.5rem;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            border-left: 6px solid var(--primary);
        }

        .user-list, .comments-list {
            max-height: 500px;
            overflow-y: auto;
            border-radius: 12px;
            border: 2px solid #f0f0f0;
        }

        .user-item, .comment-item {
            padding: 1.5rem;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }

        .user-item:hover, .comment-item:hover {
            background: #f8f9fa;
        }

        .user-item:last-child, .comment-item:last-child {
            border-bottom: none;
        }

        .user-actions, .comment-actions {
            display: flex;
            gap: 0.8rem;
        }

        .banned {
            opacity: 0.6;
            background: #f8d7da;
        }

        /* ===== COMMENT SYSTEM ===== */
        .comments-section {
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            padding: 2.5rem;
            margin: 2.5rem 0;
            border-left: 6px solid var(--info);
        }

        .comment-card {
            border-left: 4px solid var(--info);
            margin-bottom: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .comment-author {
            font-weight: 600;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .comment-date {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .comment-content {
            line-height: 1.7;
            color: #333;
            font-size: 1rem;
        }

        .comment-form {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 2rem;
            border-radius: 12px;
            margin-top: 2.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        /* ===== FORMS ===== */
        .form-container {
            background-color: white;
            max-width: 600px;
            margin: 2rem auto;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            border: 1px solid #f0f0f0;
        }

        .form-group {
            margin-bottom: 2rem;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.8rem;
            font-weight: 600;
            color: var(--dark);
            font-size: 1rem;
        }

        .form-control {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fafbfc;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.1);
            background: white;
        }

        .password-toggle {
            position: absolute;
            right: 15px;
            top: 42px;
            background: none;
            border: none;
            cursor: pointer;
            color: #6c757d;
            font-size: 1.2rem;
            transition: color 0.3s ease;
        }

        .password-toggle:hover {
            color: var(--primary);
        }

        .user-type {
            display: flex;
            gap: 20px;
            margin-bottom: 2.5rem;
        }

        .user-type label {
            flex: 1;
            text-align: center;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fafbfc;
        }

        .user-type input[type="radio"] {
            display: none;
        }

        .user-type input[type="radio"]:checked + span {
            background: var(--gradient-primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 15px rgba(74, 111, 165, 0.3);
        }

        .user-type span {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .user-type label:hover span {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* ===== PAYMENT INFO ===== */
        .payment-info {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            padding: 2rem;
            border-radius: 12px;
            margin: 2rem 0;
            border-left: 6px solid var(--secondary);
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .payment-info h4 {
            color: var(--primary);
            margin-bottom: 1.2rem;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
        }

        /* ===== PRICE TAG ===== */
        .price-tag {
            background: var(--gradient-secondary);
            color: #333;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
            font-size: 1.1rem;
        }

        /* ===== MODALS ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background-color: white;
            padding: 3rem;
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-wide {
            max-width: 800px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #e9ecef;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #6c757d;
            transition: color 0.3s ease;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: var(--danger);
            background: #f8f9fa;
        }

        /* ===== ALERTS ===== */
        .alert {
            padding: 1.2rem 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border-left: 6px solid transparent;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border-left-color: var(--success);
        }

        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border-left-color: var(--danger);
        }

        .alert-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border-left-color: var(--info);
        }

        /* ===== FOOTER ===== */
        footer {
            background: linear-gradient(135deg, var(--dark), #2d3748);
            color: white;
            padding: 4rem 0 2rem;
            text-align: center;
        }

        .social-links {
            display: flex;
            gap: 20px;
            margin: 1.5rem 0;
            justify-content: center;
        }

        .social-links a {
            color: white;
            font-size: 2rem;
            transition: all 0.3s ease;
            padding: 12px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .social-links a:hover {
            color: var(--secondary);
            background: rgba(255,255,255,0.2);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255,255,255,0.2);
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
            }

            .main-nav {
                justify-content: center;
                gap: 5px;
            }

            .nav-tab {
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            .hero h1 {
                font-size: 2.2rem;
            }

            .hero p {
                font-size: 1.1rem;
            }

            .search-form {
                flex-direction: column;
                border-radius: 12px;
            }

            .search-input {
                border-radius: 12px 12px 0 0;
                margin-bottom: 0;
            }

            .search-btn {
                border-radius: 0 0 12px 12px;
                padding: 16px;
            }

            .user-type {
                flex-direction: column;
            }

            .modal-content {
                padding: 2rem;
                margin: 20px;
            }

            .admin-stats {
                grid-template-columns: 1fr;
            }

            .user-actions {
                flex-direction: column;
            }

            .btn {
                padding: 14px 24px;
            }

            .form-container {
                padding: 2rem;
                margin: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- ===== HEADER ===== -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-brain"></i>
                    Cover<span>Brain</span>
                </div>
                
                <div class="main-nav">
                    <button class="nav-tab active" onclick="showTab('accueil')">
                        <i class="fas fa-home"></i> Accueil
                    </button>
                    <button class="nav-tab" onclick="showTab('recherche')" id="navSearchTab">
                        <i class="fas fa-search"></i> Recherche
                    </button>
                    <!-- BOUTON MODIFIER INFOS -->
                    <button class="nav-tab hidden" onclick="showTab('modifierInfos')" id="navModifyTab">
                        <i class="fas fa-edit"></i> Modifier Infos
                    </button>
                    <button class="nav-tab" onclick="showTab('profil')" id="navProfileTab">
                        <i class="fas fa-user"></i> Profil
                    </button>
                    
                    <!-- Onglet Admin (visible uniquement pour les administrateurs) -->
                    <button class="nav-tab hidden" onclick="showTab('adminSection')" id="adminNavTab">
                        <i class="fas fa-cog"></i> Admin
                    </button>
                    
                    <div class="more-dropdown">
                        <button class="nav-tab" onclick="toggleMoreMenu(event)">
                            <i class="fas fa-ellipsis-h"></i> Plus
                        </button>
                        <div class="more-menu" id="moreMenu">
                            <a href="javascript:void(0)" onclick="showTab('commentaires')">
                                <i class="fas fa-comments"></i> Commentaires
                            </a>
                            <a href="javascript:void(0)" onclick="showTab('inscription')">
                                <i class="fas fa-user-plus"></i> S'inscrire
                            </a>
                            <a href="javascript:void(0)" onclick="showTab('about')">
                                <i class="fas fa-info-circle"></i> À propos
                            </a>
                            <a href="javascript:void(0)" onclick="showTab('confidentialite')">
                                <i class="fas fa-shield-alt"></i> Politique de confidentialité
                            </a>
                            <a href="javascript:void(0)" onclick="showAdminIfAllowed()" id="adminMenuLink" class="hidden">
                                <i class="fas fa-cog"></i> Administration
                            </a>
                        </div>
                    </div>
                    
                    <div id="userNavItem" class="hidden">
                        <div class="user-info">
                            <i class="fas fa-user"></i>
                            <span id="userName"></span>
                        </div>
                    </div>
                    
                    <button class="nav-tab" id="loginNavItem" onclick="openLoginModal()">
                        <i class="fas fa-sign-in-alt"></i> Connexion
                    </button>
                    <button class="nav-tab hidden" onclick="logoutUser()" id="logoutNavItem">
                        <i class="fas fa-sign-out-alt"></i> Déconnexion
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ===== MAIN CONTENT ===== -->
    <main>
        <!-- ===== HERO SECTION ===== -->
        <section class="hero" id="accueil">
            <div class="container">
                <h1>Trouvez le répétiteur idéal pour réussir</h1>
                <p>Cover Brain connecte les élèves avec des répétiteurs qualifiés pour un soutien scolaire personnalisé à domicile.</p>
                <p><strong>Une innovation Xtronics</strong></p>
                <a href="javascript:void(0)" class="btn" onclick="showTab('inscription')">
                    <i class="fas fa-rocket"></i> Commencer maintenant
                </a>
            </div>
        </section>

        <!-- ===== SEARCH SECTION ===== -->
        <section class="search-section hidden" id="recherche">
            <div class="container">
                <h2 class="section-title">Trouvez un répétiteur</h2>
                <form class="search-form" onsubmit="event.preventDefault(); searchTeachers(document.getElementById('searchInput').value.trim());">
                    <input type="text" class="search-input" id="searchInput" placeholder="Rechercher un cours (ex: Mathématiques, Physique, Anglais...)">
                    <button type="submit" class="search-btn"><i class="fas fa-search"></i> Rechercher</button>
                </form>
            </div>
        </section>

        <!-- ===== RESULTS SECTION ===== -->
        <section class="section results hidden" id="resultsSection">
            <div class="container">
                <h2 class="section-title" id="resultsTitle">Résultats de Recherche</h2>
                <div id="resultsContainer"></div>
            </div>
        </section>

        <!-- ===== MODIFIER INFOS SECTION ===== -->
        <section class="section hidden" id="modifierInfos">
            <div class="container">
                <h2 class="section-title">Modifier Mes Informations</h2>
                <div id="modifyFormContainer"></div>
            </div>
        </section>

        <!-- ===== PROFILE SECTION ===== -->
        <section class="section hidden" id="profil">
            <div class="container">
                <div class="form-container">
                    <h2 class="section-title">Mon Profil</h2>
                    <div id="profileFormContainer"></div>
                </div>
            </div>
        </section>

        <!-- ===== ADMIN SECTION ===== -->
        <section class="section hidden" id="adminSection">
            <div class="container">
                <h2 class="section-title">Panneau d'Administration</h2>
                
                <!-- Statistiques -->
                <div class="admin-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalUsers">0</div>
                        <div class="stat-label">Utilisateurs Totaux</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalStudents">0</div>
                        <div class="stat-label">Élèves</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalTeachers">0</div>
                        <div class="stat-label">Professeurs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalComments">0</div>
                        <div class="stat-label">Commentaires</div>
                    </div>
                </div>

                <!-- Gestion des Utilisateurs -->
                <div class="admin-section">
                    <h3><i class="fas fa-users"></i> Gestion des Utilisateurs</h3>
                    <div class="user-list" id="usersList">
                        <!-- Liste des utilisateurs chargée dynamiquement -->
                    </div>
                </div>

                <!-- Modération des Commentaires - SECTION CORRIGÉE -->
                <div class="admin-section">
                    <h3><i class="fas fa-comments"></i> Modération des Commentaires</h3>
                    <div class="admin-comments-controls" style="margin-bottom: 1rem; display: flex; gap: 10px;">
                        <button class="btn btn-primary btn-sm" onclick="loadAdminComments()">
                            <i class="fas fa-sync-alt"></i> Actualiser
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteAllComments()" id="deleteAllCommentsBtn">
                            <i class="fas fa-trash"></i> Tout supprimer
                        </button>
                    </div>
                    <div class="comments-list" id="adminCommentsList">
                        <!-- Liste des commentaires chargée dynamiquement -->
                    </div>
                </div>

                <!-- Paramètres -->
                <div class="admin-section">
                    <h3><i class="fas fa-cog"></i> Paramètres de la Plateforme</h3>
                    <div class="form-group">
                        <label>Prix séance primaire ($)</label>
                        <input type="number" class="form-control" id="primaryPrice" value="5" min="1">
                    </div>
                    <div class="form-group">
                        <label>Prix séance secondaire ($)</label>
                        <input type="number" class="form-control" id="secondaryPrice" value="7" min="1">
                    </div>
                    <div class="form-group">
                        <label>Commission des professeurs (%)</label>
                        <input type="number" class="form-control" id="commissionRate" value="10" min="0" max="50">
                    </div>
                    <button class="btn btn-primary" onclick="savePlatformSettings()">
                        <i class="fas fa-save"></i> Sauvegarder les paramètres
                    </button>
                </div>
            </div>
        </section>

        <!-- ===== REGISTRATION SECTION ===== -->
        <section class="section hidden" id="inscription">
            <div class="container">
                <h2 class="section-title">Rejoindre Cover Brain</h2>
                <div class="form-container">
                    <div id="formAlert" class="alert hidden"></div>
                    
                    <!-- Conditions d'utilisation -->
                    <div class="payment-info" id="termsConditions">
                        <h4><i class="fas fa-file-contract"></i> Conditions d'Utilisation</h4>
                        <div style="max-height: 200px; overflow-y: auto; margin-bottom: 15px; padding: 10px; background: white; border-radius: 5px;">
                            <h5>Conditions pour les Professeurs :</h5>
                            <ul style="margin-bottom: 15px;">
                                <li>J'accepte le montant fixé par l'administrateur pour mes services (<span id="currentPrimaryPrice">5</span>$/séance au primaire, <span id="currentSecondaryPrice">7</span>$/séance au secondaire)</li>
                                <li>Je m'engage à verser <span id="currentCommissionRate">10</span>% de mes bénéfices mensuels au numéro +243840426427 via Orange Money</li>
                                <li>Je comprends que tout retard de paiement pourra entraîner la suspension de mon compte</li>
                                <li>Les montants sont modifiables à tout moment par l'administration</li>
                            </ul>
                            
                            <h5>Conditions pour les Élèves :</h5>
                            <ul>
                                <li>En m'inscrivant, j'accepte de me soumettre aux prix fixés par les professeurs sur la plateforme</li>
                                <li>Je comprends que les tarifs sont établis selon le niveau scolaire (primaire/secondaire)</li>
                                <li>Je m'engage à respecter les professeurs et les conditions de service</li>
                            </ul>
                            
                            <h5>Dispositions Générales :</h5>
                            <ul>
                                <li>Toute utilisation non autorisée du nom "Cover Brain" ou tentative de plagiat sera sévèrement sanctionnée</li>
                                <li>La plateforme se réserve le droit de modifier ces conditions à tout moment</li>
                                <li>En cochant la case ci-dessous, je certifie avoir lu et accepté l'intégralité des conditions</li>
                            </ul>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="acceptTerms" style="width: auto;">
                                <span>J'ai lu et j'accepte les conditions d'utilisation ci-dessus</span>
                            </label>
                        </div>
                    </div>

                    <div class="user-type">
                        <label>
                            <input type="radio" name="userType" value="student" checked onchange="toggleUserType()">
                            <span><i class="fas fa-user-graduate"></i> Élève</span>
                        </label>
                        <label>
                            <input type="radio" name="userType" value="teacher" onchange="toggleUserType()">
                            <span><i class="fas fa-chalkboard-teacher"></i> Professeur</span>
                        </label>
                    </div>

                    <!-- Student Form -->
                    <form id="studentForm" onsubmit="event.preventDefault(); registerStudent();">
                        <div class="form-group">
                            <label for="studentName">Nom complet</label>
                            <input type="text" id="studentName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="studentPhone">Numéro de téléphone</label>
                            <input type="tel" id="studentPhone" class="form-control" placeholder="+243..." required>
                            <small style="color: #6c757d; margin-top: 5px; display: block;">Commencez par + (ex: +243840426427)</small>
                        </div>
                        <div class="form-group">
                            <label for="studentLevel">Niveau scolaire</label>
                            <select id="studentLevel" class="form-control" required>
                                <option value="">Sélectionnez</option>
                                <option value="primaire">Primaire (<span id="primaryPriceDisplay">5</span>$/séance)</option>
                                <option value="secondaire">Secondaire (<span id="secondaryPriceDisplay">7</span>$/séance)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="studentClass">Classe</label>
                            <input type="text" id="studentClass" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="studentSchool">Établissement</label>
                            <input type="text" id="studentSchool" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="studentAge">Âge</label>
                            <input type="number" id="studentAge" class="form-control" min="5" max="25" required>
                        </div>
                        <div class="form-group">
                            <label for="studentAddress">Adresse de domicile</label>
                            <input type="text" id="studentAddress" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="studentPassword">Mot de passe</label>
                            <input type="password" id="studentPassword" class="form-control" minlength="6" required>
                            <button type="button" class="password-toggle" onclick="togglePassword('studentPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-user-plus"></i> S'inscrire
                        </button>
                    </form>

                    <!-- Teacher Form -->
                    <form id="teacherForm" class="hidden" onsubmit="event.preventDefault(); registerTeacher();">
                        <div class="payment-info">
                            <h4><i class="fas fa-info-circle"></i> Informations importantes pour les Professeurs</h4>
                            <p><strong>Commission :</strong> <span id="commissionRateDisplay">10</span>% des revenus mensuels à verser au +243 840426427</p>
                            <p><strong>Tarifs actuels :</strong> Primaire: <span id="teacherPrimaryPrice">5</span>$/séance, Secondaire: <span id="teacherSecondaryPrice">7</span>$/séance</p>
                            <p><strong>Attention :</strong> Les mauvais payeurs seront bannis définitivement</p>
                        </div>
                        <div class="form-group">
                            <label for="teacherName">Nom complet</label>
                            <input type="text" id="teacherName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="teacherPhone">Numéro de téléphone</label>
                            <input type="tel" id="teacherPhone" class="form-control" placeholder="+243..." required>
                            <small style="color: #6c757d; margin-top: 5px; display: block;">Commencez par + (ex: +243840426427)</small>
                        </div>
                        <div class="form-group">
                            <label for="teacherSubjects">Matières enseignées</label>
                            <input type="text" id="teacherSubjects" class="form-control" placeholder="Mathématiques, Physique..." required>
                        </div>
                        <div class="form-group">
                            <label for="teacherClass">Niveaux enseignés</label>
                            <input type="text" id="teacherClass" class="form-control" placeholder="Primaire, Collège..." required>
                        </div>
                        <div class="form-group">
                            <!-- AJOUT DU CHAMP NOMBRE MAX D'ÉLÈVES -->
                            <label for="teacherMaxStudents">Nombre maximum d'élèves encadrables</label>
                            <input type="number" id="teacherMaxStudents" class="form-control" min="1" max="50" value="10" required>
                        </div>
                        <div class="form-group">
                            <label for="teacherSchool">Établissement / Formation</label>
                            <input type="text" id="teacherSchool" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="teacherAddress">Adresse de domicile</label>
                            <input type="text" id="teacherAddress" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="teacherPassword">Mot de passe</label>
                            <input type="password" id="teacherPassword" class="form-control" minlength="6" required>
                            <button type="button" class="password-toggle" onclick="togglePassword('teacherPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-user-plus"></i> S'inscrire
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <!-- ===== COMMENTS SECTION ===== -->
        <section class="section hidden" id="commentaires">
            <div class="container">
                <h2 class="section-title">Espace Commentaires</h2>
                <div class="comments-section">
                    <div id="commentsContainer">
                        <!-- Commentaires chargés dynamiquement -->
                    </div>
                    <div class="comment-form">
                        <h3>Laisser un commentaire</h3>
                        <form onsubmit="event.preventDefault(); addComment();">
                            <div class="form-group">
                                <label for="commentAuthor">Votre nom</label>
                                <input type="text" id="commentAuthor" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="commentText">Votre message</label>
                                <textarea id="commentText" class="form-control" placeholder="Partagez votre expérience avec Cover Brain..." required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> Publier le commentaire
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <!-- ===== ABOUT SECTION ===== -->
        <section class="section hidden" id="about">
            <div class="container">
                <div class="form-container">
                    <h2 class="section-title">À Propos de Cover Brain</h2>
                    <div class="about-content">
                        <h3>Notre Mission</h3>
                        <p>Cover Brain est la première plateforme congolaise dédiée à la mise en relation entre élèves et répétiteurs qualifiés. Notre mission est de faciliter l'accès à l'éducation de qualité pour tous.</p>
                        
                        <h3>Protection de la Marque</h3>
                        <div class="payment-info">
                            <h4><i class="fas fa-exclamation-triangle"></i> Avertissement Légal</h4>
                            <p><strong>Toute tentative de plagiat ou d'usage non autorisé du nom "Cover Brain", de son logo, de son concept ou de tout élément distinctive de la plateforme est strictement interdite et sera poursuivie conformément à la loi.</strong></p>
                            <p>La plateforme Cover Brain et son écosystème sont la propriété exclusive de Xtronics. Toute reproduction, imitation ou utilisation non autorisée entraînera des poursuites judiciaires et des dommages-intérêts.</p>
                        </div>
                        
                        <h3>Contact</h3>
                        <p><strong>WhatsApp : +243 840426427</strong></p>
                        <p><strong>Email : contact@coverbrain.cd</strong></p>
                        
                        <div class="teacher-actions" style="margin-top: 2rem;">
                            <button class="btn btn-outline" onclick="showTab('confidentialite')">
                                <i class="fas fa-shield-alt"></i> Politique de confidentialité
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ===== POLITIQUE DE CONFIDENTIALITÉ ===== -->
        <section class="section hidden" id="confidentialite">
            <div class="container">
                <div class="form-container">
                    <h2 class="section-title">Politique de Confidentialité</h2>
                    <div class="privacy-content">
                        <h3>Pourquoi nous collectons vos informations ?</h3>
                        <p>Chez Cover Brain, nous recueillons vos informations personnelles dans le but unique de fournir et d'améliorer nos services de mise en relation entre élèves et professeurs.</p>
                        
                        <h3>Utilisation des données collectées :</h3>
                        <div class="payment-info">
                            <h4><i class="fas fa-database"></i> Données collectées et leur finalité</h4>
                            <ul>
                                <li><strong>Informations de contact :</strong> Pour faciliter la communication entre élèves et professeurs</li>
                                <li><strong>Niveau scolaire et matières :</strong> Pour assurer des correspondances pertinentes</li>
                                <li><strong>Localisation :</strong> Pour proposer des professeurs proches de votre domicile</li>
                                <li><strong>Informations de paiement :</strong> Uniquement pour la gestion des commissions des professeurs</li>
                            </ul>
                        </div>

                        <h3>Protection de vos données :</h3>
                        <p>Vos données sont stockées de manière sécurisée sur Firebase et ne sont accessibles qu'aux administrateurs de la plateforme pour la modération et la gestion du service.</p>

                        <h3>Partage des informations :</h3>
                        <p>Vos coordonnées (nom et téléphone) sont partagées uniquement entre élèves et professeurs qui se mettent en relation via notre plateforme. Nous ne vendons ni ne louons vos informations à des tiers.</p>

                        <h3>Vos droits :</h3>
                        <p>Vous avez le droit de consulter, modifier ou supprimer vos informations à tout moment via votre profil ou en nous contactant directement.</p>

                        <div class="teacher-actions" style="margin-top: 2rem;">
                            <button class="btn btn-primary" onclick="showTab('about')">
                                <i class="fas fa-arrow-left"></i> Retour à À propos
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- ===== FOOTER ===== -->
    <footer>
        <div class="container">
            <p><strong>Cover Brain - Plateforme de Répétiteurs</strong></p>
            <div class="social-links">
                <a href="https://wa.me/243840426427" target="_blank"><i class="fab fa-whatsapp"></i></a>
                <a href="https://m.me/cm/AbaT9AqAW84FF7Sk/?send_source=cm%3Acopy_invite_link" target="_blank"><i class="fab fa-facebook-messenger"></i></a>
            </div>
            <p>Contact : +243 840426427 (WhatsApp)</p>
            <p>© 2024 Xtronics - Tous droits réservés</p>
        </div>
    </footer>

    <!-- ===== MODALS ===== -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Connexion</h2>
                <button class="close-btn" onclick="closeLoginModal()">&times;</button>
            </div>
            <div id="loginAlert" class="alert hidden"></div>
            <div class="form-group">
                <label for="loginPhone">Numéro de téléphone</label>
                <input type="tel" id="loginPhone" class="form-control" placeholder="+243..." required>
                <small style="color: #6c757d; margin-top: 5px; display: block;">Commencez par + (ex: +243840426427)</small>
            </div>
            <div class="form-group">
                <label for="loginPassword">Mot de passe</label>
                <input type="password" id="loginPassword" class="form-control" required>
                <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            <button class="btn btn-primary" onclick="loginUser()">
                <i class="fas fa-sign-in-alt"></i> Se connecter
            </button>
        </div>
    </div>

    <script>
        // ===== FIREBASE CONFIGURATION =====
        const firebaseConfig = {
            apiKey: "AIzaSyAglsqHPVXXXEl0rfTyu793gKqo9A9ZO6s",
            authDomain: "cover-brain-f0732.firebaseapp.com",
            projectId: "cover-brain-f0732",
            storageBucket: "cover-brain-f0732.firebasestorage.app",
            messagingSenderId: "501343145001",
            appId: "1:501343145001:web:def3a1659b2f0411512038"
        };

        // ===== FIREBASE INITIALIZATION =====
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("✅ Firebase initialisé avec succès!");
        } catch (error) {
            console.log("Firebase déjà initialisé");
        }

        const db = firebase.firestore();
        const auth = firebase.auth();

        // ===== GLOBAL VARIABLES =====
        let currentUser = JSON.parse(localStorage.getItem('coverBrainCurrentUser')) || null;
        let isLoggedIn = currentUser !== null;
        let platformSettings = {
            primaryPrice: 5,
            secondaryPrice: 7,
            commissionRate: 10
        };

        // ===== CRÉATION AUTOMATIQUE DES PARAMÈTRES =====
        async function createDefaultSettings() {
            try {
                const settingsDoc = await db.collection('platformSettings').doc('pricing').get();
                
                if (!settingsDoc.exists) {
                    console.log('🆕 Création des paramètres par défaut...');
                    await db.collection('platformSettings').doc('pricing').set({
                        primaryPrice: 5,
                        secondaryPrice: 7,
                        commissionRate: 10,
                        updatedAt: new Date()
                    });
                    console.log('✅ Paramètres créés avec succès!');
                }
            } catch (error) {
                console.error('Erreur création paramètres:', error);
            }
        }

        // ===== APPLICATION INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            setupEventListeners();
            checkLoginStatus();
            await createDefaultSettings(); // CRÉE LES PARAMÈTRES SI BESOIN
            await loadPlatformSettings();
            await loadComments();
            console.log("✅ Application Cover Brain initialisée");
        }

        function setupEventListeners() {
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.more-dropdown')) {
                    document.getElementById('moreMenu').classList.remove('show');
                }
            });
        }

        // ===== CHARGEMENT DES PARAMÈTRES =====
        async function loadPlatformSettings() {
            try {
                const settingsDoc = await db.collection('platformSettings').doc('pricing').get();
                if (settingsDoc.exists) {
                    const settings = settingsDoc.data();
                    platformSettings = {
                        primaryPrice: settings.primaryPrice || 5,
                        secondaryPrice: settings.secondaryPrice || 7,
                        commissionRate: settings.commissionRate || 10
                    };
                    
                    // Mettre à jour l'affichage des prix
                    updatePriceDisplays();
                    
                    // Mettre à jour les valeurs dans le panneau admin
                    if (document.getElementById('primaryPrice')) {
                        document.getElementById('primaryPrice').value = platformSettings.primaryPrice;
                        document.getElementById('secondaryPrice').value = platformSettings.secondaryPrice;
                        document.getElementById('commissionRate').value = platformSettings.commissionRate;
                    }
                }
            } catch (error) {
                console.error('Erreur chargement paramètres:', error);
            }
        }

        // ===== MISE À JOUR DE L'AFFICHAGE DES PRIX =====
        function updatePriceDisplays() {
            console.log('🔄 Mise à jour des prix:', platformSettings);
            
            // Mettre à jour tous les éléments avec les prix
            const priceElements = {
                'currentPrimaryPrice': platformSettings.primaryPrice,
                'currentSecondaryPrice': platformSettings.secondaryPrice,
                'currentCommissionRate': platformSettings.commissionRate,
                'primaryPriceDisplay': platformSettings.primaryPrice,
                'secondaryPriceDisplay': platformSettings.secondaryPrice,
                'commissionRateDisplay': platformSettings.commissionRate,
                'teacherPrimaryPrice': platformSettings.primaryPrice,
                'teacherSecondaryPrice': platformSettings.secondaryPrice
            };
            
            Object.keys(priceElements).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = priceElements[id];
                }
            });
            
            // Mettre à jour aussi les options du select
            const primaryOption = document.querySelector('option[value="primaire"]');
            const secondaryOption = document.querySelector('option[value="secondaire"]');
            
            if (primaryOption) {
                primaryOption.textContent = `Primaire (${platformSettings.primaryPrice}$/séance)`;
            }
            if (secondaryOption) {
                secondaryOption.textContent = `Secondaire (${platformSettings.secondaryPrice}$/séance)`;
            }
            
            console.log('✅ Affichage des prix mis à jour');
        }

        // ===== FONCTION POUR AFFICHER/MASQUER LE MOT DE PASSE =====
        function togglePassword(passwordFieldId) {
            const passwordField = document.getElementById(passwordFieldId);
            const toggleButton = passwordField.nextElementSibling;
            const icon = toggleButton.querySelector('i');
            
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordField.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        // ===== NAVIGATION =====
        function toggleMoreMenu(event) {
            event.stopPropagation();
            const menu = document.getElementById('moreMenu');
            menu.classList.toggle('show');
        }

        function showTab(tabId) {
            document.querySelectorAll('main > section').forEach(section => {
                section.classList.add('hidden');
            });

            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            const activeTab = document.querySelector(`[onclick="showTab('${tabId}')"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }

            const targetSection = document.getElementById(tabId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }

            if (tabId === 'modifierInfos') {
                showModifyForm();
            } else if (tabId === 'profil') {
                showProfile();
            } else if (tabId === 'recherche') {
                document.getElementById('resultsContainer').innerHTML = '';
                document.getElementById('resultsSection').classList.add('hidden');
            } else if (tabId === 'adminSection') {
                loadAdminPanel();
            } else if (tabId === 'inscription') {
                updatePriceDisplays(); // FORCER le rafraîchissement des prix
            }
            
            document.getElementById('moreMenu').classList.remove('show');
        }

        // ===== INSCRIPTIONS =====
        function toggleUserType() {
            const isStudent = document.querySelector('input[name="userType"]:checked').value === 'student';
            document.getElementById('studentForm').classList.toggle('hidden', !isStudent);
            document.getElementById('teacherForm').classList.toggle('hidden', isStudent);
        }

        async function registerStudent() {
            if (!document.getElementById('acceptTerms').checked) {
                showAlert('formAlert', 'Vous devez accepter les conditions d\'utilisation pour vous inscrire', 'danger');
                return;
            }

            const studentData = {
                name: document.getElementById('studentName').value,
                phone: document.getElementById('studentPhone').value,
                level: document.getElementById('studentLevel').value,
                class: document.getElementById('studentClass').value,
                school: document.getElementById('studentSchool').value,
                age: parseInt(document.getElementById('studentAge').value),
                address: document.getElementById('studentAddress').value,
                password: document.getElementById('studentPassword').value,
                createdAt: new Date()
            };

            // Vérification du format du téléphone
            if (!studentData.phone.startsWith('+')) {
                showAlert('formAlert', 'Le numéro de téléphone doit commencer par + (ex: +243840426427)', 'danger');
                return;
            }

            try {
                const usersSnapshot = await db.collection('students')
                    .where('phone', '==', studentData.phone)
                    .get();

                if (!usersSnapshot.empty) {
                    showAlert('formAlert', 'Un utilisateur avec ce numéro existe déjà', 'danger');
                    return;
                }

                await db.collection('students').add(studentData);
                showAlert('formAlert', 'Inscription réussie! Vous pouvez maintenant vous connecter.', 'success');
                document.getElementById('studentForm').reset();

            } catch (error) {
                console.error('Erreur inscription étudiant:', error);
                showAlert('formAlert', 'Erreur lors de l\'inscription', 'danger');
            }
        }

        async function registerTeacher() {
            if (!document.getElementById('acceptTerms').checked) {
                showAlert('formAlert', 'Vous devez accepter les conditions d\'utilisation pour vous inscrire', 'danger');
                return;
            }

            const teacherData = {
                name: document.getElementById('teacherName').value,
                phone: document.getElementById('teacherPhone').value,
                subjects: document.getElementById('teacherSubjects').value.split(',').map(s => s.trim()),
                classLevels: document.getElementById('teacherClass').value.split(',').map(s => s.trim()),
                maxStudents: parseInt(document.getElementById('teacherMaxStudents').value),
                school: document.getElementById('teacherSchool').value,
                address: document.getElementById('teacherAddress').value,
                password: document.getElementById('teacherPassword').value,
                available: true,
                visible: true,
                rating: 0,
                totalRatings: 0,
                verified: true,
                createdAt: new Date()
            };

            // Vérification du format du téléphone
            if (!teacherData.phone.startsWith('+')) {
                showAlert('formAlert', 'Le numéro de téléphone doit commencer par + (ex: +243840426427)', 'danger');
                return;
            }

            try {
                const usersSnapshot = await db.collection('teachers')
                    .where('phone', '==', teacherData.phone)
                    .get();

                if (!usersSnapshot.empty) {
                    showAlert('formAlert', 'Un utilisateur avec ce numéro existe déjà', 'danger');
                    return;
                }

                await db.collection('teachers').add(teacherData);
                showAlert('formAlert', 'Inscription réussie! Votre compte est maintenant actif.', 'success');
                document.getElementById('teacherForm').reset();

            } catch (error) {
                console.error('Erreur inscription professeur:', error);
                showAlert('formAlert', 'Erreur lors de l\'inscription', 'danger');
            }
        }

        // ===== MODIFIER INFOS =====
        async function showModifyForm() {
            const modifyFormContainer = document.getElementById('modifyFormContainer');
            modifyFormContainer.innerHTML = '';

            if (!currentUser) {
                modifyFormContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <i class="fas fa-edit fa-3x" style="color: #6c757d; margin-bottom: 1rem;"></i>
                        <h3 style="color: #6c757d;">Connectez-vous pour modifier vos informations</h3>
                        <button class="btn btn-primary" onclick="openLoginModal()">
                            <i class="fas fa-sign-in-alt"></i> Se connecter
                        </button>
                    </div>
                `;
                return;
            }

            try {
                if (currentUser.type === 'student') {
                    const snapshot = await db.collection('students')
                        .where('phone', '==', currentUser.phone)
                        .where('password', '==', currentUser.password)
                        .get();

                    if (snapshot.empty) {
                        modifyFormContainer.innerHTML = '<p>Profil non trouvé</p>';
                        return;
                    }

                    const studentDoc = snapshot.docs[0];
                    const student = studentDoc.data();

                    modifyFormContainer.innerHTML = `
                        <div class="form-container">
                            <h3>Modifier Mes Informations - Élève</h3>
                            <div id="modifyAlert" class="alert hidden"></div>
                            <form onsubmit="event.preventDefault(); updateStudentInfo('${studentDoc.id}');">
                                <div class="form-group">
                                    <label for="modifyStudentName">Nom complet</label>
                                    <input type="text" id="modifyStudentName" class="form-control" value="${student.name}" required>
                                </div>
                                <div class="form-group">
                                    <label for="modifyStudentLevel">Niveau scolaire</label>
                                    <select id="modifyStudentLevel" class="form-control" required>
                                        <option value="primaire" ${student.level === 'primaire' ? 'selected' : ''}>Primaire (${platformSettings.primaryPrice}$/séance)</option>
                                        <option value="secondaire" ${student.level === 'secondaire' ? 'selected' : ''}>Secondaire (${platformSettings.secondaryPrice}$/séance)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="modifyStudentClass">Classe</label>
                                    <input type="text" id="modifyStudentClass" class="form-control" value="${student.class}" required>
                                </div>
                                <div class="form-group">
                                    <label for="modifyStudentSchool">Établissement</label>
                                    <input type="text" id="modifyStudentSchool" class="form-control" value="${student.school}" required>
                                </div>
                                <div class="form-group">
                                    <label for="modifyStudentAge">Âge</label>
                                    <input type="number" id="modifyStudentAge" class="form-control" value="${student.age}" min="5" max="25" required>
                                </div>
                                <div class="form-group">
                                    <label for="modifyStudentAddress">Adresse de domicile</label>
                                    <input type="text" id="modifyStudentAddress" class="form-control" value="${student.address}" required>
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Sauvegarder les modifications
                                </button>
                            </form>
                        </div>
                    `;

                } else if (currentUser.type === 'teacher') {
                    const snapshot = await db.collection('teachers')
                        .where('phone', '==', currentUser.phone)
                        .where('password', '==', currentUser.password)
                        .get();

                    if (snapshot.empty) {
                        modifyFormContainer.innerHTML = '<p>Profil non trouvé</p>';
                        return;
                    }

                    const teacherDoc = snapshot.docs[0];
                    const teacher = teacherDoc.data();

                    modifyFormContainer.innerHTML = `
                        <div class="form-container">
                            <h3>Modifier Mes Informations - Professeur</h3>
                            <div id="modifyAlert" class="alert hidden"></div>
                            <form onsubmit="event.preventDefault(); updateTeacherInfo('${teacherDoc.id}');">
                                <div class="form-group">
                                    <label for="modifyTeacherName">Nom complet</label>
                                    <input type="text" id="modifyTeacherName" class="form-control" value="${teacher.name}" required>
                                </div>
                                <div class="form-group">
                                    <label for="modifyTeacherSubjects">Matières enseignées</label>
                                    <input type="text" id="modifyTeacherSubjects" class="form-control" value="${teacher.subjects.join(', ')}" placeholder="Mathématiques, Physique..." required>
                                </div>
                                <div class="form-group">
                                    <label for="modifyTeacherClass">Niveaux enseignés</label>
                                    <input type="text" id="modifyTeacherClass" class="form-control" value="${teacher.classLevels.join(', ')}" placeholder="Primaire, Collège..." required>
                                </div>
                                <div class="form-group">
                                    <label for="modifyTeacherMaxStudents">Nombre maximum d'élèves encadrables</label>
                                    <input type="number" id="modifyTeacherMaxStudents" class="form-control" value="${teacher.maxStudents}" min="1" max="50" required>
                                </div>
                                <div class="form-group">
                                    <label for="modifyTeacherSchool">Établissement / Formation</label>
                                    <input type="text" id="modifyTeacherSchool" class="form-control" value="${teacher.school}" required>
                                </div>
                                <div class="form-group">
                                    <label for="modifyTeacherAddress">Adresse de domicile</label>
                                    <input type="text" id="modifyTeacherAddress" class="form-control" value="${teacher.address}" required>
                                </div>
                                
                                <div class="form-group">
                                    <label>Statut de visibilité</label>
                                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                                        <button type="button" class="btn ${teacher.visible ? 'btn-success' : 'btn-secondary'}" onclick="toggleVisibility('${teacherDoc.id}', true)">
                                            <i class="fas fa-eye"></i> Apparaître
                                        </button>
                                        <button type="button" class="btn ${!teacher.visible ? 'btn-warning' : 'btn-secondary'}" onclick="toggleVisibility('${teacherDoc.id}', false)">
                                            <i class="fas fa-eye-slash"></i> Disparaître
                                        </button>
                                    </div>
                                    <p style="margin-top: 10px; color: #6c757d; font-size: 0.9rem;">
                                        ${teacher.visible ? 
                                            '🟢 Vous êtes actuellement visible dans les recherches' : 
                                            '🔴 Vous êtes actuellement caché des recherches'}
                                    </p>
                                </div>

                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Sauvegarder les modifications
                                </button>
                            </form>
                        </div>
                    `;
                }

            } catch (error) {
                console.error('Erreur chargement formulaire modification:', error);
                modifyFormContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <i class="fas fa-exclamation-triangle fa-3x" style="color: #dc3545; margin-bottom: 1rem;"></i>
                        <h3 style="color: #dc3545;">Erreur de chargement</h3>
                        <p>Impossible de charger vos informations. Veuillez réessayer.</p>
                    </div>
                `;
            }
        }

        async function updateStudentInfo(studentId) {
            try {
                const updatedData = {
                    name: document.getElementById('modifyStudentName').value,
                    level: document.getElementById('modifyStudentLevel').value,
                    class: document.getElementById('modifyStudentClass').value,
                    school: document.getElementById('modifyStudentSchool').value,
                    age: parseInt(document.getElementById('modifyStudentAge').value),
                    address: document.getElementById('modifyStudentAddress').value,
                    updatedAt: new Date()
                };

                await db.collection('students').doc(studentId).update(updatedData);

                // Mettre à jour l'utilisateur courant
                currentUser = { ...currentUser, ...updatedData };
                localStorage.setItem('coverBrainCurrentUser', JSON.stringify(currentUser));

                showAlert('modifyAlert', 'Informations mises à jour avec succès!', 'success');
                
            } catch (error) {
                console.error('Erreur mise à jour étudiant:', error);
                showAlert('modifyAlert', 'Erreur lors de la mise à jour des informations', 'danger');
            }
        }

        async function updateTeacherInfo(teacherId) {
            try {
                const updatedData = {
                    name: document.getElementById('modifyTeacherName').value,
                    subjects: document.getElementById('modifyTeacherSubjects').value.split(',').map(s => s.trim()),
                    classLevels: document.getElementById('modifyTeacherClass').value.split(',').map(s => s.trim()),
                    maxStudents: parseInt(document.getElementById('modifyTeacherMaxStudents').value),
                    school: document.getElementById('modifyTeacherSchool').value,
                    address: document.getElementById('modifyTeacherAddress').value,
                    updatedAt: new Date()
                };

                await db.collection('teachers').doc(teacherId).update(updatedData);

                // Mettre à jour l'utilisateur courant
                currentUser = { ...currentUser, ...updatedData };
                localStorage.setItem('coverBrainCurrentUser', JSON.stringify(currentUser));

                showAlert('modifyAlert', 'Informations mises à jour avec succès!', 'success');
                
            } catch (error) {
                console.error('Erreur mise à jour professeur:', error);
                showAlert('modifyAlert', 'Erreur lors de la mise à jour des informations', 'danger');
            }
        }

        async function toggleVisibility(teacherId, isVisible) {
            try {
                await db.collection('teachers').doc(teacherId).update({
                    visible: isVisible,
                    updatedAt: new Date()
                });

                // Mettre à jour l'utilisateur courant
                if (currentUser && currentUser.type === 'teacher') {
                    currentUser.visible = isVisible;
                    localStorage.setItem('coverBrainCurrentUser', JSON.stringify(currentUser));
                }

                showModifyForm();
                showAlert('modifyAlert', `Vous êtes maintenant ${isVisible ? 'visible' : 'caché'} dans les recherches`, 'success');

            } catch (error) {
                console.error('Erreur changement visibilité:', error);
                showAlert('modifyAlert', 'Erreur lors du changement de visibilité', 'danger');
            }
        }

        // ===== PROFIL =====
        async function showProfile() {
            const profileFormContainer = document.getElementById('profileFormContainer');
            profileFormContainer.innerHTML = '';

            if (!currentUser) {
                profileFormContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <i class="fas fa-user fa-3x" style="color: #6c757d; margin-bottom: 1rem;"></i>
                        <h3 style="color: #6c757d;">Connectez-vous pour voir votre profil</h3>
                        <button class="btn btn-primary" onclick="openLoginModal()">
                            <i class="fas fa-sign-in-alt"></i> Se connecter
                        </button>
                    </div>
                `;
                return;
            }

            try {
                if (currentUser.type === 'student') {
                    const snapshot = await db.collection('students')
                        .where('phone', '==', currentUser.phone)
                        .where('password', '==', currentUser.password)
                        .get();

                    if (snapshot.empty) {
                        profileFormContainer.innerHTML = '<p>Profil non trouvé</p>';
                        return;
                    }

                    const student = snapshot.docs[0].data();

                    profileFormContainer.innerHTML = `
                        <div class="student-card">
                            <h3>${student.name}</h3>
                            <div class="student-info">
                                <div class="info-item">
                                    <i class="fas fa-phone"></i>
                                    <span><strong>Téléphone:</strong> ${student.phone}</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-graduation-cap"></i>
                                    <span><strong>Niveau:</strong> ${student.level}</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-user-graduate"></i>
                                    <span><strong>Classe:</strong> ${student.class}</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-school"></i>
                                    <span><strong>Établissement:</strong> ${student.school}</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-birthday-cake"></i>
                                    <span><strong>Âge:</strong> ${student.age} ans</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span><strong>Adresse:</strong> ${student.address}</span>
                                </div>
                            </div>
                            <div class="student-actions">
                                <button class="btn btn-primary" onclick="showTab('modifierInfos')">
                                    <i class="fas fa-edit"></i> Modifier mes informations
                                </button>
                            </div>
                        </div>
                    `;

                } else if (currentUser.type === 'teacher') {
                    const snapshot = await db.collection('teachers')
                        .where('phone', '==', currentUser.phone)
                        .where('password', '==', currentUser.password)
                        .get();

                    if (snapshot.empty) {
                        profileFormContainer.innerHTML = '<p>Profil non trouvé</p>';
                        return;
                    }

                    const teacher = snapshot.docs[0].data();
                    const ratingStars = generateRatingStars(teacher.rating);

                    profileFormContainer.innerHTML = `
                        <div class="teacher-card">
                            <h3>${teacher.name}</h3>
                            <div class="rating">
                                ${ratingStars}
                                <span class="rating-value">${teacher.rating.toFixed(1)}</span>
                                <span style="color: #6c757d; margin-left: 8px;">(${teacher.totalRatings} avis)</span>
                            </div>
                            <div class="teacher-info">
                                <div class="info-item">
                                    <i class="fas fa-phone"></i>
                                    <span><strong>Téléphone:</strong> ${teacher.phone}</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-book"></i>
                                    <span><strong>Matières:</strong> ${teacher.subjects.join(', ')}</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-graduation-cap"></i>
                                    <span><strong>Niveaux:</strong> ${teacher.classLevels.join(', ')}</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-users"></i>
                                    <span><strong>Élèves max:</strong> ${teacher.maxStudents}</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-school"></i>
                                    <span><strong>Formation:</strong> ${teacher.school}</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span><strong>Adresse:</strong> ${teacher.address}</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-eye"></i>
                                    <span><strong>Visibilité:</strong> ${teacher.visible ? 'Visible' : 'Caché'}</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-check-circle"></i>
                                    <span><strong>Statut:</strong> ${teacher.verified ? 'Vérifié' : 'Non vérifié'}</span>
                                </div>
                            </div>
                            <div class="teacher-actions">
                                <button class="btn btn-primary" onclick="showTab('modifierInfos')">
                                    <i class="fas fa-edit"></i> Modifier mes informations
                                </button>
                            </div>
                        </div>
                    `;
                }

            } catch (error) {
                console.error('Erreur chargement profil:', error);
                profileFormContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <i class="fas fa-exclamation-triangle fa-3x" style="color: #dc3545; margin-bottom: 1rem;"></i>
                        <h3 style="color: #dc3545;">Erreur de chargement</h3>
                        <p>Impossible de charger votre profil. Veuillez réessayer.</p>
                    </div>
                `;
            }
        }

        // ===== RECHERCHE =====
        async function searchTeachers(searchTerm) {
            if (!isLoggedIn) {
                showAlert('formAlert', 'Connectez-vous pour rechercher des professeurs', 'danger');
                openLoginModal();
                return;
            }

            if (currentUser.type !== 'student') {
                showAlert('formAlert', 'Seuls les élèves peuvent rechercher des professeurs', 'warning');
                return;
            }

            if (!searchTerm) {
                showAlert('formAlert', 'Veuillez entrer un terme de recherche', 'danger');
                return;
            }

            try {
                const snapshot = await db.collection('teachers').get();
                const teachers = [];
                
                snapshot.forEach(doc => {
                    const teacher = { id: doc.id, ...doc.data() };
                    // Vérifier si le professeur n'est pas banni, est disponible et visible
                    if (!teacher.banned && teacher.verified && teacher.available && teacher.visible !== false) {
                        const searchLower = searchTerm.toLowerCase();
                        const matches = 
                            teacher.subjects?.some(s => s.toLowerCase().includes(searchLower)) ||
                            teacher.name.toLowerCase().includes(searchLower) ||
                            teacher.classLevels?.some(level => level.toLowerCase().includes(searchLower));
                        
                        if (matches) {
                            teachers.push(teacher);
                        }
                    }
                });

                displaySearchResults(teachers);

            } catch (error) {
                console.error('Erreur recherche:', error);
                showAlert('formAlert', 'Erreur lors de la recherche', 'danger');
            }
        }

        function displaySearchResults(teachers) {
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = '';

            document.getElementById('resultsTitle').textContent = teachers.length > 0 
                ? `${teachers.length} Professeur(s) Trouvé(s)` 
                : 'Aucun professeur trouvé';

            if (teachers.length === 0) {
                resultsContainer.innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <i class="fas fa-search fa-3x" style="color: #6c757d; margin-bottom: 1rem;"></i>
                        <h3 style="color: #6c757d;">Aucun professeur trouvé</h3>
                        <p>Essayez avec d'autres termes comme "Mathématiques", "Français", "Physique"...</p>
                    </div>
                `;
                return;
            }

            teachers.forEach(teacher => {
                const price = currentUser?.level === 'primaire' ? platformSettings.primaryPrice : platformSettings.secondaryPrice;
                const ratingStars = generateRatingStars(teacher.rating);

                const teacherCard = document.createElement('div');
                teacherCard.className = 'teacher-card';
                teacherCard.innerHTML = `
                    <h3>${teacher.name} 
                        <span class="availability-status ${teacher.available ? 'available' : 'unavailable'}">
                            <i class="fas ${teacher.available ? 'fa-check' : 'fa-pause'}"></i>
                            ${teacher.available ? 'Disponible' : 'Indisponible'}
                        </span>
                    </h3>
                    <div class="rating">
                        ${ratingStars}
                        <span class="rating-value">${teacher.rating.toFixed(1)}</span>
                        <span style="color: #6c757d; margin-left: 8px;">(${teacher.totalRatings} avis)</span>
                    </div>
                    <div class="teacher-info">
                        <div class="info-item">
                            <i class="fas fa-book"></i>
                            <span><strong>Matières:</strong> ${teacher.subjects.join(', ')}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-graduation-cap"></i>
                            <span><strong>Niveaux:</strong> ${teacher.classLevels.join(', ')}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-users"></i>
                            <span><strong>Élèves max:</strong> ${teacher.maxStudents || 'Non spécifié'}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-school"></i>
                            <span><strong>Formation:</strong> ${teacher.school}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span><strong>Zone:</strong> ${teacher.address}</span>
                        </div>
                    </div>
                    <div class="price-tag">${price}$/séance</div>
                    <div class="teacher-actions">
                        <a href="https://wa.me/${teacher.phone}?text=${encodeURIComponent(`Bonjour ${teacher.name}%2C%20je%20suis%20intéressé(e)%20par%20vos%20services%20de%20répétition%20sur%20Cover%20Brain.`)}" class="btn btn-whatsapp" target="_blank">
                            <i class="fab fa-whatsapp"></i> Contacter
                        </a>
                        <button class="btn btn-primary" onclick="rateTeacher('${teacher.id}')">
                            <i class="fas fa-star"></i> Noter
                        </button>
                    </div>
                `;

                resultsContainer.appendChild(teacherCard);
            });

            document.getElementById('resultsSection').classList.remove('hidden');
        }

        function generateRatingStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            
            let stars = '';
            
            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="fas fa-star" style="color: #ffc107;"></i>';
            }
            
            if (hasHalfStar) {
                stars += '<i class="fas fa-star-half-alt" style="color: #ffc107;"></i>';
            }
            
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="far fa-star" style="color: #ffc107;"></i>';
            }
            
            return stars;
        }

        // ===== NOTATION DES PROFESSEURS =====
        async function rateTeacher(teacherId) {
            if (!isLoggedIn) {
                showAlert('formAlert', 'Connectez-vous pour noter un professeur', 'danger');
                openLoginModal();
                return;
            }

            const rating = prompt('Donnez une note de 1 à 5 étoiles à ce professeur:');
            if (!rating || isNaN(rating) || rating < 1 || rating > 5) {
                alert('Veuillez entrer une note valide entre 1 et 5');
                return;
            }

            try {
                const teacherRef = db.collection('teachers').doc(teacherId);
                const teacherDoc = await teacherRef.get();
                
                if (!teacherDoc.exists) {
                    alert('Professeur non trouvé');
                    return;
                }

                const teacher = teacherDoc.data();
                const newTotalRatings = teacher.totalRatings + 1;
                const newRating = ((teacher.rating * teacher.totalRatings) + parseFloat(rating)) / newTotalRatings;

                await teacherRef.update({
                    rating: newRating,
                    totalRatings: newTotalRatings
                });

                alert('Merci pour votre notation!');
                // Recharger les résultats de recherche
                const searchTerm = document.getElementById('searchInput').value.trim();
                if (searchTerm) {
                    searchTeachers(searchTerm);
                }

            } catch (error) {
                console.error('Erreur notation:', error);
                alert('Erreur lors de la notation');
            }
        }

        // ===== COMMENTAIRES =====
        async function loadComments() {
            try {
                const snapshot = await db.collection('comments')
                    .orderBy('createdAt', 'desc')
                    .limit(20)
                    .get();

                const commentsContainer = document.getElementById('commentsContainer');
                commentsContainer.innerHTML = '';

                if (snapshot.empty) {
                    commentsContainer.innerHTML = `
                        <div style="text-align: center; padding: 2rem;">
                            <i class="fas fa-comments fa-3x" style="color: #6c757d; margin-bottom: 1rem;"></i>
                            <h3 style="color: #6c757d;">Aucun commentaire pour le moment</h3>
                            <p>Soyez le premier à partager votre expérience!</p>
                        </div>
                    `;
                    return;
                }

                snapshot.forEach(doc => {
                    const comment = doc.data();
                    const commentDate = comment.createdAt.toDate();
                    const formattedDate = commentDate.toLocaleDateString('fr-FR', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });

                    const commentCard = document.createElement('div');
                    commentCard.className = 'comment-card';
                    commentCard.innerHTML = `
                        <div class="comment-header">
                            <div class="comment-author">${comment.author}</div>
                            <div class="comment-date">${formattedDate}</div>
                        </div>
                        <div class="comment-content">${comment.text}</div>
                    `;

                    commentsContainer.appendChild(commentCard);
                });

            } catch (error) {
                console.error('Erreur chargement commentaires:', error);
            }
        }

        async function addComment() {
            const author = document.getElementById('commentAuthor').value.trim();
            const text = document.getElementById('commentText').value.trim();

            if (!author || !text) {
                alert('Veuillez remplir tous les champs');
                return;
            }

            try {
                await db.collection('comments').add({
                    author: author,
                    text: text,
                    createdAt: new Date()
                });

                document.getElementById('commentAuthor').value = '';
                document.getElementById('commentText').value = '';

                await loadComments();
                alert('Commentaire publié avec succès!');

            } catch (error) {
                console.error('Erreur ajout commentaire:', error);
                alert('Erreur lors de la publication du commentaire');
            }
        }

        // ===== GESTION DES COMMENTAIRES ADMIN =====
        async function loadAdminComments() {
            try {
                const snapshot = await db.collection('comments')
                    .orderBy('createdAt', 'desc')
                    .get();

                const adminCommentsList = document.getElementById('adminCommentsList');
                adminCommentsList.innerHTML = '';

                if (snapshot.empty) {
                    adminCommentsList.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: #6c757d;">
                            <i class="fas fa-comments fa-2x"></i>
                            <p>Aucun commentaire à modérer</p>
                        </div>
                    `;
                    return;
                }

                snapshot.forEach(doc => {
                    const comment = doc.data();
                    const commentDate = comment.createdAt.toDate();
                    const formattedDate = commentDate.toLocaleDateString('fr-FR', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });

                    const commentItem = document.createElement('div');
                    commentItem.className = 'comment-item';
                    commentItem.innerHTML = `
                        <div style="flex: 1;">
                            <strong>${comment.author}</strong>
                            <div style="color: #6c757d; font-size: 0.9rem; margin: 5px 0;">${formattedDate}</div>
                            <div>${comment.text}</div>
                        </div>
                        <div class="comment-actions">
                            <button class="btn btn-sm btn-danger" onclick="deleteComment('${doc.id}')">
                                <i class="fas fa-trash"></i> Supprimer
                            </button>
                        </div>
                    `;

                    adminCommentsList.appendChild(commentItem);
                });

            } catch (error) {
                console.error('Erreur chargement commentaires admin:', error);
            }
        }

        async function deleteAllComments() {
            if (!confirm('Êtes-vous sûr de vouloir supprimer TOUS les commentaires ? Cette action est irréversible.')) return;

            try {
                const snapshot = await db.collection('comments').get();
                const batch = db.batch();
                
                snapshot.forEach(doc => {
                    batch.delete(doc.ref);
                });

                await batch.commit();
                alert('Tous les commentaires ont été supprimés avec succès!');
                loadAdminComments();
                loadComments();

            } catch (error) {
                console.error('Erreur suppression commentaires:', error);
                alert('Erreur lors de la suppression des commentaires');
            }
        }

        // ===== AUTHENTIFICATION =====
        function openLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('loginAlert').classList.add('hidden');
        }

        async function loginUser() {
            const phone = document.getElementById('loginPhone').value.trim();
            const password = document.getElementById('loginPassword').value.trim();

            if (!phone || !password) {
                showAlert('loginAlert', 'Veuillez remplir tous les champs', 'danger');
                return;
            }

            // Vérification du format du téléphone
            if (!phone.startsWith('+')) {
                showAlert('loginAlert', 'Le numéro de téléphone doit commencer par + (ex: +243840426427)', 'danger');
                return;
            }

            try {
                // RECHERCHE DANS LES ÉTUDIANTS
                let studentSnapshot = await db.collection('students')
                    .where('phone', '==', phone)
                    .where('password', '==', password)
                    .get();

                if (!studentSnapshot.empty) {
                    const studentDoc = studentSnapshot.docs[0];
                    const student = studentDoc.data();
                    
                    currentUser = {
                        id: studentDoc.id,
                        type: 'student',
                        name: student.name,
                        phone: student.phone,
                        password: student.password
                    };
                    
                    localStorage.setItem('coverBrainCurrentUser', JSON.stringify(currentUser));
                    isLoggedIn = true;
                    
                    closeLoginModal();
                    checkLoginStatus();
                    showAlert('formAlert', `Bienvenue ${student.name}!`, 'success');
                    return;
                }

                // RECHERCHE DANS LES PROFESSEURS
                let teacherSnapshot = await db.collection('teachers')
                    .where('phone', '==', phone)
                    .where('password', '==', password)
                    .get();

                if (!teacherSnapshot.empty) {
                    const teacherDoc = teacherSnapshot.docs[0];
                    const teacher = teacherDoc.data();
                    
                    currentUser = {
                        id: teacherDoc.id,
                        type: 'teacher',
                        name: teacher.name,
                        phone: teacher.phone,
                        password: teacher.password
                    };
                    
                    localStorage.setItem('coverBrainCurrentUser', JSON.stringify(currentUser));
                    isLoggedIn = true;
                    
                    closeLoginModal();
                    checkLoginStatus();
                    showAlert('formAlert', `Bienvenue ${teacher.name}!`, 'success');
                    return;
                }

                // RECHERCHE DANS LES ADMINISTRATEURS
                let adminSnapshot = await db.collection('admins').get();
                let adminFound = false;
                
                adminSnapshot.forEach(doc => {
                    const admin = doc.data();
                    if (admin.phone === phone && admin.password === password) {
                        currentUser = {
                            id: doc.id,
                            type: 'admin',
                            name: admin.name,
                            phone: admin.phone,
                            password: admin.password
                        };
                        
                        localStorage.setItem('coverBrainCurrentUser', JSON.stringify(currentUser));
                        isLoggedIn = true;
                        adminFound = true;
                        
                        closeLoginModal();
                        checkLoginStatus();
                        showAlert('formAlert', `Bienvenue ${admin.name}!`, 'success');
                        return;
                    }
                });

                if (adminFound) return;

                showAlert('loginAlert', 'Numéro de téléphone ou mot de passe incorrect', 'danger');

            } catch (error) {
                console.error('Erreur connexion:', error);
                showAlert('loginAlert', 'Erreur lors de la connexion', 'danger');
            }
        }

        function logoutUser() {
            currentUser = null;
            isLoggedIn = false;
            localStorage.removeItem('coverBrainCurrentUser');
            checkLoginStatus();
            showTab('accueil');
            showAlert('formAlert', 'Vous avez été déconnecté avec succès', 'success');
        }

        // ===== ADMINISTRATION =====
        function showAdminIfAllowed() {
            if (currentUser && currentUser.type === 'admin') {
                showTab('adminSection');
            } else {
                alert('Accès réservé aux administrateurs');
            }
        }

        async function loadAdminPanel() {
            if (!currentUser || currentUser.type !== 'admin') {
                alert('Accès non autorisé');
                showTab('accueil');
                return;
            }

            try {
                // Charger les statistiques
                const studentsSnapshot = await db.collection('students').get();
                const teachersSnapshot = await db.collection('teachers').get();
                const commentsSnapshot = await db.collection('comments').get();

                document.getElementById('totalUsers').textContent = studentsSnapshot.size + teachersSnapshot.size;
                document.getElementById('totalStudents').textContent = studentsSnapshot.size;
                document.getElementById('totalTeachers').textContent = teachersSnapshot.size;
                document.getElementById('totalComments').textContent = commentsSnapshot.size;

                // Charger les paramètres actuels
                await loadPlatformSettings();

                // Charger la liste des utilisateurs
                const usersList = document.getElementById('usersList');
                usersList.innerHTML = '';

                studentsSnapshot.forEach(doc => {
                    const student = doc.data();
                    const userItem = document.createElement('div');
                    userItem.className = 'user-item';
                    userItem.innerHTML = `
                        <div>
                            <strong>${student.name}</strong>
                            <div style="color: #6c757d; font-size: 0.9rem;">
                                ${student.phone} • Élève • ${student.level}
                            </div>
                        </div>
                        <div class="user-actions">
                            <button class="btn btn-sm btn-danger" onclick="banUser('students', '${doc.id}')">
                                <i class="fas fa-ban"></i> Bannir
                            </button>
                        </div>
                    `;
                    usersList.appendChild(userItem);
                });

                teachersSnapshot.forEach(doc => {
                    const teacher = doc.data();
                    const userItem = document.createElement('div');
                    userItem.className = `user-item ${teacher.banned ? 'banned' : ''}`;
                    userItem.innerHTML = `
                        <div>
                            <strong>${teacher.name}</strong>
                            <div style="color: #6c757d; font-size: 0.9rem;">
                                ${teacher.phone} • Professeur • ${teacher.subjects.join(', ')}
                            </div>
                        </div>
                        <div class="user-actions">
                            <button class="btn btn-sm ${teacher.banned ? 'btn-success' : 'btn-danger'}" 
                                onclick="${teacher.banned ? `unbanUser('teachers', '${doc.id}')` : `banUser('teachers', '${doc.id}')`}">
                                <i class="fas ${teacher.banned ? 'fa-check' : 'fa-ban'}"></i> 
                                ${teacher.banned ? 'Débannir' : 'Bannir'}
                            </button>
                        </div>
                    `;
                    usersList.appendChild(userItem);
                });

                // Charger les commentaires pour modération
                await loadAdminComments();

            } catch (error) {
                console.error('Erreur chargement panel admin:', error);
            }
        }

        async function banUser(collection, userId) {
            if (!confirm('Êtes-vous sûr de vouloir bannir cet utilisateur?')) return;

            try {
                await db.collection(collection).doc(userId).update({
                    banned: true,
                    bannedAt: new Date()
                });
                alert('Utilisateur banni avec succès');
                loadAdminPanel();
            } catch (error) {
                console.error('Erreur bannissement:', error);
                alert('Erreur lors du bannissement');
            }
        }

        async function unbanUser(collection, userId) {
            if (!confirm('Êtes-vous sûr de vouloir débannir cet utilisateur?')) return;

            try {
                await db.collection(collection).doc(userId).update({
                    banned: false
                });
                alert('Utilisateur débanni avec succès');
                loadAdminPanel();
            } catch (error) {
                console.error('Erreur débannissement:', error);
                alert('Erreur lors du débannissement');
            }
        }

        async function deleteComment(commentId) {
            if (!confirm('Êtes-vous sûr de vouloir supprimer ce commentaire?')) return;

            try {
                await db.collection('comments').doc(commentId).delete();
                alert('Commentaire supprimé avec succès');
                // Recharger les commentaires dans l'admin et dans la section publique
                loadAdminComments();
                loadComments();
            } catch (error) {
                console.error('Erreur suppression commentaire:', error);
                alert('Erreur lors de la suppression');
            }
        }

        // ===== SAUVEGARDE DES PARAMÈTRES =====
        async function savePlatformSettings() {
            try {
                const primaryPrice = parseInt(document.getElementById('primaryPrice').value);
                const secondaryPrice = parseInt(document.getElementById('secondaryPrice').value);
                const commissionRate = parseInt(document.getElementById('commissionRate').value);

                // Mettre à jour IMMÉDIATEMENT les variables locales
                platformSettings.primaryPrice = primaryPrice;
                platformSettings.secondaryPrice = secondaryPrice;
                platformSettings.commissionRate = commissionRate;

                // Sauvegarder dans Firebase
                await db.collection('platformSettings').doc('pricing').set({
                    primaryPrice: primaryPrice,
                    secondaryPrice: secondaryPrice,
                    commissionRate: commissionRate,
                    updatedAt: new Date()
                }, { merge: true });

                // FORCER la mise à jour de l'affichage sur TOUTES les pages
                updatePriceDisplays();
                
                alert('✅ Paramètres sauvegardés! Les nouveaux tarifs sont maintenant actifs partout.');

            } catch (error) {
                console.error('Erreur sauvegarde paramètres:', error);
                alert('❌ Erreur lors de la sauvegarde des paramètres');
            }
        }

        // ===== UTILITAIRES =====
        function checkLoginStatus() {
            if (isLoggedIn && currentUser) {
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userNavItem').classList.remove('hidden');
                document.getElementById('logoutNavItem').classList.remove('hidden');
                document.getElementById('loginNavItem').classList.add('hidden');

                // Afficher l'onglet modifier infos pour tous les utilisateurs connectés
                document.getElementById('navModifyTab').classList.remove('hidden');

                // Afficher l'onglet admin si l'utilisateur est admin
                if (currentUser.type === 'admin') {
                    document.getElementById('adminNavTab').classList.remove('hidden');
                    document.getElementById('adminMenuLink').classList.remove('hidden');
                } else {
                    document.getElementById('adminNavTab').classList.add('hidden');
                    document.getElementById('adminMenuLink').classList.add('hidden');
                }
            } else {
                document.getElementById('userNavItem').classList.add('hidden');
                document.getElementById('logoutNavItem').classList.add('hidden');
                document.getElementById('loginNavItem').classList.remove('hidden');
                document.getElementById('navModifyTab').classList.add('hidden');
                document.getElementById('adminNavTab').classList.add('hidden');
                document.getElementById('adminMenuLink').classList.add('hidden');
            }
        }

        function showAlert(containerId, message, type) {
            const alertContainer = document.getElementById(containerId);
            alertContainer.textContent = message;
            alertContainer.className = `alert alert-${type}`;
            alertContainer.classList.remove('hidden');
            setTimeout(() => {
                alertContainer.classList.add('hidden');
            }, 5000);
        }
    </script>
</body>
</html>