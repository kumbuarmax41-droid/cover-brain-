<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cover Brain - Plateforme de Répétiteurs</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        :root {
            --primary: #4a6fa5; --secondary: #ffc107; --dark: #343a40; --light: #f5f7fa;
            --success: #28a745; --danger: #dc3545; --info: #17a2b8; --warning: #ffc107;
        }
        body { background-color: var(--light); color: #333; line-height: 1.6; }
        .container { width: 90%; max-width: 1200px; margin: 0 auto; padding: 0 15px; }
        .hidden { display: none !important; }
        
        /* HEADER */
        header { background-color: var(--primary); color: white; padding: 1rem 0; position: sticky; top: 0; z-index: 1000; }
        .header-content { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
        .logo { font-size: 1.8rem; font-weight: bold; display: flex; align-items: center; gap: 10px; }
        .logo span { color: var(--secondary); }
        .main-nav { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        .nav-tab { padding: 10px 20px; background: rgba(255,255,255,0.1); border-radius: 8px; cursor: pointer; 
                  border: none; color: white; font-weight: 500; transition: all 0.3s; }
        .nav-tab:hover { background: rgba(255,255,255,0.2); }
        .nav-tab.active { background: var(--secondary); color: #333; }
        .more-dropdown { position: relative; }
        .more-menu { position: absolute; top: 100%; right: 0; background: white; border-radius: 8px; 
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2); min-width: 200px; display: none; z-index: 1000; }
        .more-menu.show { display: block; }
        .more-menu a { display: block; padding: 12px 20px; color: var(--dark); text-decoration: none; 
                      border-bottom: 1px solid #eee; transition: background 0.3s; }
        .more-menu a:hover { background: #f8f9fa; color: var(--primary); }
        .user-info { display: flex; align-items: center; background: rgba(255,255,255,0.2); 
                    padding: 8px 15px; border-radius: 20px; gap: 8px; }
        .notification-badge { background-color: var(--danger); color: white; border-radius: 50%; 
                            width: 20px; height: 20px; display: flex; align-items: center; 
                            justify-content: center; font-size: 0.8rem; position: absolute; 
                            top: -5px; right: -5px; }
        
        /* HERO */
        .hero { background: linear-gradient(rgba(74, 111, 165, 0.8), rgba(74, 111, 165, 0.9)); 
               color: white; padding: 5rem 0; text-align: center; }
        .hero h1 { font-size: 2.5rem; margin-bottom: 1.5rem; }
        .hero p { font-size: 1.2rem; max-width: 700px; margin: 0 auto 2.5rem; }
        
        /* BOUTONS */
        .btn { display: inline-flex; align-items: center; gap: 8px; background-color: var(--secondary); 
              color: #333; padding: 14px 28px; border: none; border-radius: 8px; font-weight: 600; 
              cursor: pointer; text-decoration: none; transition: all 0.3s ease; font-size: 1rem; }
        .btn:hover { background-color: #e0a800; transform: translateY(-2px); }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-success { background-color: var(--success); color: white; }
        .btn-danger { background-color: var(--danger); color: white; }
        .btn-whatsapp { background-color: #25D366; color: white; }
        .btn-sm { padding: 8px 16px; font-size: 0.9rem; }
        
        /* SECTIONS */
        .section { padding: 3rem 0; }
        .section-title { text-align: center; margin-bottom: 2rem; color: var(--primary); position: relative; }
        .section-title::after { content: ''; display: block; width: 80px; height: 4px; 
                              background: var(--secondary); margin: 15px auto; border-radius: 2px; }
        
        /* RECHERCHE */
        .search-section { background-color: #e9ecef; padding: 3rem 0; }
        .search-form { display: flex; max-width: 800px; margin: 0 auto; gap: 0; }
        .search-input { flex: 1; padding: 15px 20px; border: 2px solid #ddd; 
                       border-radius: 8px 0 0 8px; font-size: 1.1rem; }
        .search-btn { background-color: var(--primary); color: white; border: none; 
                     padding: 0 25px; border-radius: 0 8px 8px 0; cursor: pointer; font-size: 1.1rem; }
        
        /* CARDS */
        .teacher-card, .comment-card { background-color: white; border-radius: 12px; 
                                      box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 2rem; 
                                      margin-bottom: 2rem; transition: all 0.3s ease; 
                                      border-left: 4px solid var(--primary); }
        .teacher-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        .teacher-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
                       gap: 1.2rem; margin: 1.5rem 0; }
        .info-item { display: flex; align-items: center; gap: 12px; }
        .info-item i { color: var(--primary); width: 20px; text-align: center; }
        .courses-list { display: flex; flex-wrap: wrap; gap: 10px; margin: 1.2rem 0; }
        .course-tag { background: linear-gradient(135deg, var(--primary), #2c5282); color: white; 
                     padding: 6px 14px; border-radius: 20px; font-size: 0.85rem; font-weight: 500; }
        .teacher-actions { display: flex; gap: 12px; margin-top: 1.5rem; }
        
        /* PANIER */
        .cart-items { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
                     gap: 1.5rem; margin-top: 1.5rem; }
        .cart-item { background: #f8f9fa; border-radius: 12px; padding: 1.5rem; display: flex; 
                    flex-direction: column; position: relative; transition: all 0.3s; 
                    border: 2px solid transparent; }
        .cart-item.pending { border-left-color: var(--warning); }
        .cart-item.accepted { border-left-color: var(--success); }
        .cart-item.rejected { border-left-color: var(--danger); }
        .status-dot { width: 14px; height: 14px; border-radius: 50%; position: absolute; 
                     top: 15px; right: 15px; }
        .status-dot.pending { background-color: var(--warning); }
        .status-dot.accepted { background-color: var(--success); }
        .status-dot.rejected { background-color: var(--danger); }
        .contact-info { background: white; padding: 1rem; border-radius: 8px; margin-top: 1rem; 
                       border: 1px solid #e9ecef; }
        
        /* FORMULAIRES */
        .form-container { background-color: white; max-width: 600px; margin: 2rem auto; 
                         padding: 2.5rem; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 1.8rem; }
        .form-group label { display: block; margin-bottom: 0.7rem; font-weight: 600; color: var(--dark); }
        .form-control { width: 100%; padding: 12px 16px; border: 2px solid #e9ecef; 
                       border-radius: 8px; font-size: 1rem; }
        .user-type { display: flex; gap: 15px; margin-bottom: 2rem; }
        .user-type label { flex: 1; text-align: center; padding: 15px; border: 2px solid #e9ecef; 
                          border-radius: 8px; cursor: pointer; transition: all 0.3s; }
        .user-type input[type="radio"] { display: none; }
        .user-type input[type="radio"]:checked + span { background-color: var(--primary); 
                                                      color: white; border-color: var(--primary); }
        .user-type span { display: flex; flex-direction: column; align-items: center; gap: 8px; 
                         padding: 10px; border-radius: 6px; font-weight: 500; }
        
        /* ADMIN */
        .admin-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
                      gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 12px; text-align: center; 
                    box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-left: 4px solid var(--primary); }
        .stat-number { font-size: 2.5rem; font-weight: bold; color: var(--primary); margin-bottom: 0.5rem; }
        .stat-label { color: #6c757d; font-weight: 500; }
        .admin-section { background: white; border-radius: 12px; padding: 2rem; margin-bottom: 2rem; 
                        box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .user-list, .comments-list { max-height: 400px; overflow-y: auto; }
        .user-item, .comment-item { padding: 1rem; border-bottom: 1px solid #e9ecef; 
                                   display: flex; justify-content: space-between; align-items: center; }
        .user-item:hover, .comment-item:hover { background: #f8f9fa; }
        .user-actions, .comment-actions { display: flex; gap: 0.5rem; }
        .banned { opacity: 0.6; background: #f8d7da; }
        
        /* MODALS */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background-color: rgba(0,0,0,0.6); z-index: 2000; align-items: center; 
                justify-content: center; padding: 20px; }
        .modal-content { background-color: white; padding: 2.5rem; border-radius: 15px; 
                        max-width: 500px; width: 100%; box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; 
                       margin-bottom: 1.8rem; padding-bottom: 1.2rem; border-bottom: 2px solid #e9ecef; }
        .close-btn { background: none; border: none; font-size: 1.8rem; cursor: pointer; color: #6c757d; }
        
        /* ALERTS */
        .alert { padding: 1rem 1.2rem; border-radius: 8px; margin-bottom: 1.5rem; 
                border-left: 4px solid transparent; }
        .alert-success { background-color: #d4edda; color: #155724; border-left-color: var(--success); }
        .alert-danger { background-color: #f8d7da; color: #721c24; border-left-color: var(--danger); }
        
        /* FOOTER */
        footer { background: linear-gradient(135deg, var(--dark), #2d3748); color: white; 
                padding: 3rem 0 2rem; text-align: center; }
        .social-links { display: flex; gap: 20px; margin: 1rem 0; justify-content: center; }
        .social-links a { color: white; font-size: 1.8rem; transition: all 0.3s; padding: 10px; 
                         border-radius: 50%; background: rgba(255,255,255,0.1); }
        .social-links a:hover { color: var(--secondary); background: rgba(255,255,255,0.2); }
        
        @media (max-width: 768px) {
            .header-content { flex-direction: column; gap: 15px; }
            .main-nav { justify-content: center; }
            .hero h1 { font-size: 2.2rem; }
            .search-form { flex-direction: column; }
            .search-input, .search-btn { border-radius: 8px; margin-bottom: 10px; }
            .user-type { flex-direction: column; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo"><i class="fas fa-brain"></i> Cover<span>Brain</span></div>
                <div class="main-nav">
                    <button class="nav-tab active" data-tab="accueil">Accueil</button>
                    <button class="nav-tab" data-tab="recherche">Recherche</button>
                    <button class="nav-tab" data-tab="panier">Panier <span id="cartBadge" class="notification-badge hidden">0</span></button>
                    <button class="nav-tab" data-tab="profil">Profil</button>
                    <div class="more-dropdown">
                        <button class="nav-tab" id="moreTab">Plus <i class="fas fa-chevron-down"></i></button>
                        <div class="more-menu" id="moreMenu">
                            <a href="#" data-section="commentaires">Commentaires</a>
                            <a href="#" data-section="inscription">S'inscrire</a>
                            <a href="#" data-section="about">À propos</a>
                            <a href="https://www.facebook.com/groups/coverbrain" target="_blank"><i class="fab fa-facebook"></i> Communauté</a>
                        </div>
                    </div>
                    <div id="userNavItem" class="hidden"><div class="user-info"><i class="fas fa-user"></i><span id="userName"></span></div></div>
                    <button class="nav-tab" id="loginNavItem">Connexion</button>
                    <button class="nav-tab hidden" id="logoutNavItem">Déconnexion</button>
                </div>
            </div>
        </div>
    </header>

    <main>
        <section class="hero" id="accueil">
            <div class="container">
                <h1>Trouvez le répétiteur idéal pour réussir</h1>
                <p>Cover Brain connecte les élèves avec des répétiteurs qualifiés pour un soutien scolaire personnalisé.</p>
                <p><strong>Une innovation Xtronics</strong></p>
                <a href="#" class="btn" data-section="inscription">Commencer maintenant</a>
            </div>
        </section>

        <section class="search-section hidden" id="recherche">
            <div class="container">
                <h2 class="section-title">Trouvez un répétiteur</h2>
                <form class="search-form" id="searchForm">
                    <input type="text" class="search-input" id="searchInput" placeholder="Mathématiques, Physique, Anglais...">
                    <button type="submit" class="search-btn"><i class="fas fa-search"></i> Rechercher</button>
                </form>
            </div>
        </section>

        <section class="section results hidden" id="resultsSection">
            <div class="container"><h2 class="section-title" id="resultsTitle">Résultats</h2><div id="resultsContainer"></div></div>
        </section>

        <section class="section hidden" id="panier">
            <div class="container"><h2 class="section-title" id="cartTitle">Mon Espace</h2><div id="cartContainer"></div></div>
        </section>

        <section class="section hidden" id="profil">
            <div class="container"><div class="form-container"><h2 class="section-title">Mon Profil</h2><div id="profileFormContainer"></div></div></div>
        </section>

        <!-- SECTION ADMIN -->
        <section class="section hidden" id="adminSection">
            <div class="container">
                <h2 class="section-title">Panneau d'Administration</h2>
                <div class="admin-stats">
                    <div class="stat-card"><div class="stat-number" id="totalUsers">0</div><div class="stat-label">Utilisateurs</div></div>
                    <div class="stat-card"><div class="stat-number" id="totalStudents">0</div><div class="stat-label">Élèves</div></div>
                    <div class="stat-card"><div class="stat-number" id="totalTeachers">0</div><div class="stat-label">Professeurs</div></div>
                    <div class="stat-card"><div class="stat-number" id="totalInvitations">0</div><div class="stat-label">Invitations</div></div>
                </div>

                <div class="admin-section">
                    <h3><i class="fas fa-users"></i> Gestion des Utilisateurs</h3>
                    <div class="user-list" id="usersList"></div>
                </div>

                <div class="admin-section">
                    <h3><i class="fas fa-comments"></i> Modération des Commentaires</h3>
                    <div class="comments-list" id="adminCommentsList"></div>
                </div>

                <div class="admin-section">
                    <h3><i class="fas fa-cog"></i> Paramètres</h3>
                    <div class="form-group"><label>Prix primaire ($)</label><input type="number" class="form-control" id="primaryPrice" value="5" min="1"></div>
                    <div class="form-group"><label>Prix secondaire ($)</label><input type="number" class="form-control" id="secondaryPrice" value="7" min="1"></div>
                    <div class="form-group"><label>Commission (%)</label><input type="number" class="form-control" id="commissionRate" value="10" min="0" max="50"></div>
                    <button class="btn btn-primary" onclick="savePlatformSettings()"><i class="fas fa-save"></i> Sauvegarder</button>
                </div>
            </div>
        </section>

        <section class="section hidden" id="inscription">
            <div class="container">
                <h2 class="section-title">Rejoindre Cover Brain</h2>
                <div class="form-container">
                    <div id="formAlert" class="alert hidden"></div>
                    <div class="user-type">
                        <label><input type="radio" name="userType" value="student" checked><span><i class="fas fa-user-graduate"></i> Élève</span></label>
                        <label><input type="radio" name="userType" value="teacher"><span><i class="fas fa-chalkboard-teacher"></i> Professeur</span></label>
                    </div>

                    <form id="studentForm">
                        <div class="form-group"><label>Nom complet</label><input type="text" id="studentName" class="form-control" required></div>
                        <div class="form-group"><label>Téléphone</label><input type="tel" id="studentPhone" class="form-control" required></div>
                        <div class="form-group"><label>Niveau</label><select id="studentLevel" class="form-control" required><option value="">Sélectionnez</option><option value="primaire">Primaire (5$)</option><option value="secondaire">Secondaire (7$)</option></select></div>
                        <div class="form-group"><label>Classe</label><input type="text" id="studentClass" class="form-control" required></div>
                        <div class="form-group"><label>École</label><input type="text" id="studentSchool" class="form-control" required></div>
                        <div class="form-group"><label>Âge</label><input type="number" id="studentAge" class="form-control" min="5" max="25" required></div>
                        <div class="form-group"><label>Adresse</label><input type="text" id="studentAddress" class="form-control" required></div>
                        <div class="form-group"><label>Mot de passe</label><input type="password" id="studentPassword" class="form-control" minlength="6" required></div>
                        <button type="submit" class="btn btn-primary">S'inscrire</button>
                    </form>

                    <form id="teacherForm" class="hidden">
                        <div class="payment-info" style="background: #fff3cd; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                            <h4><i class="fas fa-info-circle"></i> Conditions</h4>
                            <p><strong>Commission :</strong> 10% des revenus</p>
                            <p><strong>Paiement :</strong> Orange Money +243 840426427</p>
                        </div>
                        <div class="form-group"><label>Nom complet</label><input type="text" id="teacherName" class="form-control" required></div>
                        <div class="form-group"><label>Téléphone</label><input type="tel" id="teacherPhone" class="form-control" required></div>
                        <div class="form-group"><label>Matières</label><input type="text" id="teacherSubjects" class="form-control" placeholder="Math, Physique..." required></div>
                        <div class="form-group"><label>Niveaux</label><input type="text" id="teacherClass" class="form-control" placeholder="Primaire, Secondaire..." required></div>
                        <div class="form-group"><label>Formation</label><input type="text" id="teacherSchool" class="form-control" required></div>
                        <div class="form-group"><label>Adresse</label><input type="text" id="teacherAddress" class="form-control" required></div>
                        <div class="form-group"><label>Élèves max</label><input type="number" id="maxStudents" class="form-control" min="1" max="20" required></div>
                        <div class="form-group"><label>Mot de passe</label><input type="password" id="teacherPassword" class="form-control" minlength="6" required></div>
                        <button type="submit" class="btn btn-primary">S'inscrire</button>
                    </form>
                </div>
            </div>
        </section>

        <section class="section hidden" id="commentaires">
            <div class="container">
                <h2 class="section-title">Commentaires</h2>
                <div class="comments-section" style="background: white; padding: 2rem; border-radius: 12px;">
                    <div id="commentsContainer"></div>
                    <div class="comment-form" style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-top: 2rem;">
                        <h3>Laisser un commentaire</h3>
                        <form id="commentForm">
                            <div class="form-group"><label>Votre nom</label><input type="text" id="commentAuthor" class="form-control" required></div>
                            <div class="form-group"><label>Votre message</label><textarea id="commentText" class="form-control" required></textarea></div>
                            <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Publier</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <section class="section hidden" id="about">
            <div class="container">
                <div class="form-container">
                    <h2 class="section-title">À Propos</h2>
                    <div style="background: #f8f9fa; padding: 2rem; border-radius: 12px;">
                        <h3><i class="fas fa-rocket"></i> Notre Mission</h3>
                        <p>Cover Brain connecte élèves et répétiteurs qualifiés.</p>
                        
                        <h3 style="margin-top: 2rem;"><i class="fas fa-users"></i> Communauté</h3>
                        <p>Rejoignez-nous sur Facebook :</p>
                        <a href="https://www.facebook.com/groups/coverbrain" target="_blank" class="btn" style="background: #1877F2; color: white; margin-top: 1rem;">
                            <i class="fab fa-facebook"></i> Groupe Facebook
                        </a>

                        <h3 style="margin-top: 2rem;"><i class="fas fa-phone"></i> Contact</h3>
                        <p><strong>WhatsApp :</strong> +243 840426427</p>
                        <p><strong>Innovation :</strong> Xtronics</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p><strong>Cover Brain - Plateforme de Répétiteurs</strong></p>
            <div class="social-links">
                <a href="https://wa.me/243840426427" target="_blank"><i class="fab fa-whatsapp"></i></a>
                <a href="https://www.facebook.com/groups/coverbrain" target="_blank"><i class="fab fa-facebook"></i></a>
            </div>
            <p>Contact : +243 840426427</p>
            <p>© 2024 Xtronics</p>
        </div>
    </footer>

    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Connexion</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div id="loginAlert" class="alert hidden"></div>
            <div class="form-group"><label>Téléphone</label><input type="tel" id="loginPhone" class="form-control" required></div>
            <div class="form-group"><label>Mot de passe</label><input type="password" id="loginPassword" class="form-control" required></div>
            <button class="btn btn-primary" id="loginBtn">Se connecter</button>
        </div>
    </div>

    <script>
        // ===== FIREBASE CONFIG =====
        const firebaseConfig = {
            apiKey: "AIzaSyAglsqHPVXXXEl0rfTyu793gKqo9A9ZO6s",
            authDomain: "cover-brain-f0732.firebaseapp.com",
            projectId: "cover-brain-f0732",
            storageBucket: "cover-brain-f0732.firebasestorage.app",
            messagingSenderId: "501343145001",
            appId: "1:501343145001:web:def3a1659b2f0411512038"
        };

        // ===== INITIALISATION RAPIDE =====
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        let currentUser = JSON.parse(localStorage.getItem('coverBrainCurrentUser')) || null;
        let isLoggedIn = currentUser !== null;

        // ===== APPLICATION ULTRA-RAPIDE =====
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            setupEventListeners();
            checkLoginStatus();
            loadComments();
        }

        function setupEventListeners() {
            // Navigation ultra-rapide
            document.querySelectorAll('.nav-tab[data-tab]').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    showTab(tabId);
                });
            });

            // Menu Plus
            document.getElementById('moreTab').addEventListener('click', function(e) {
                e.stopPropagation();
                document.getElementById('moreMenu').classList.toggle('show');
            });
            document.addEventListener('click', () => document.getElementById('moreMenu').classList.remove('show'));

            // Navigation sections
            document.querySelectorAll('[data-section]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const sectionId = this.getAttribute('data-section');
                    showSection(sectionId);
                });
            });

            // Inscriptions
            document.querySelectorAll('input[name="userType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    document.getElementById('studentForm').classList.toggle('hidden', this.value !== 'student');
                    document.getElementById('teacherForm').classList.toggle('hidden', this.value === 'student');
                });
            });

            document.getElementById('studentForm').addEventListener('submit', function(e) {
                e.preventDefault(); registerStudent();
            });
            document.getElementById('teacherForm').addEventListener('submit', function(e) {
                e.preventDefault(); registerTeacher();
            });

            // Commentaires
            document.getElementById('commentForm').addEventListener('submit', function(e) {
                e.preventDefault(); addComment();
            });

            // Recherche avec mot-clé DENVER
            document.getElementById('searchForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const searchTerm = document.getElementById('searchInput').value.trim();
                if (searchTerm.toUpperCase() === 'DENVER' && currentUser?.type === 'admin') {
                    showAdminPanel(); return;
                }
                if (searchTerm) searchTeachers(searchTerm);
            });

            // Authentification
            document.getElementById('loginNavItem').addEventListener('click', function() {
                document.getElementById('loginModal').style.display = 'flex';
            });
            document.getElementById('loginBtn').addEventListener('click', loginUser);
            document.getElementById('logoutNavItem').addEventListener('click', logoutUser);
            document.querySelector('.close-btn').addEventListener('click', function() {
                document.getElementById('loginModal').style.display = 'none';
            });
        }

        // ===== FONCTIONS PRINCIPALES RAPIDES =====
        function showTab(tabId) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.remove('hidden');
            
            if (tabId === 'panier') showCart();
            if (tabId === 'profil') showProfile();
        }

        function showSection(sectionId) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(sectionId).classList.remove('hidden');
            if (sectionId === 'commentaires') loadComments();
        }

        async function registerStudent() {
            const data = {
                name: document.getElementById('studentName').value,
                phone: document.getElementById('studentPhone').value,
                level: document.getElementById('studentLevel').value,
                class: document.getElementById('studentClass').value,
                school: document.getElementById('studentSchool').value,
                age: parseInt(document.getElementById('studentAge').value),
                address: document.getElementById('studentAddress').value,
                password: document.getElementById('studentPassword').value,
                createdAt: new Date()
            };

            try {
                const exists = await db.collection('students').where('phone', '==', data.phone).get();
                if (!exists.empty) { showAlert('formAlert', 'Numéro déjà utilisé', 'danger'); return; }
                
                await db.collection('students').add(data);
                showAlert('formAlert', 'Inscription réussie!', 'success');
                document.getElementById('studentForm').reset();
            } catch (error) {
                showAlert('formAlert', 'Erreur: ' + error.message, 'danger');
            }
        }

        async function registerTeacher() {
            const data = {
                name: document.getElementById('teacherName').value,
                phone: document.getElementById('teacherPhone').value,
                subjects: document.getElementById('teacherSubjects').value.split(',').map(s => s.trim()),
                classLevels: document.getElementById('teacherClass').value.split(',').map(s => s.trim()),
                school: document.getElementById('teacherSchool').value,
                address: document.getElementById('teacherAddress').value,
                maxStudents: parseInt(document.getElementById('maxStudents').value),
                currentStudents: 0,
                password: document.getElementById('teacherPassword').value,
                verified: true,
                createdAt: new Date()
            };

            try {
                const exists = await db.collection('teachers').where('phone', '==', data.phone).get();
                if (!exists.empty) { showAlert('formAlert', 'Numéro déjà utilisé', 'danger'); return; }
                
                await db.collection('teachers').add(data);
                showAlert('formAlert', 'Inscription réussie!', 'success');
                document.getElementById('teacherForm').reset();
            } catch (error) {
                showAlert('formAlert', 'Erreur: ' + error.message, 'danger');
            }
        }

        async function addComment() {
            const author = document.getElementById('commentAuthor').value;
            const text = document.getElementById('commentText').value;

            if (!author || !text) return;

            try {
                await db.collection('comments').add({
                    author: author,
                    text: text,
                    approved: true,
                    createdAt: new Date()
                });
                loadComments();
                document.getElementById('commentForm').reset();
                showAlert('formAlert', 'Commentaire publié!', 'success');
            } catch (error) {
                showAlert('formAlert', 'Erreur: ' + error.message, 'danger');
            }
        }

        async function loadComments() {
            const container = document.getElementById('commentsContainer');
            try {
                const snapshot = await db.collection('comments').where('approved', '==', true).orderBy('createdAt', 'desc').get();
                
                if (snapshot.empty) {
                    container.innerHTML = '<div class="alert alert-info">Aucun commentaire</div>';
                    return;
                }

                container.innerHTML = snapshot.docs.map(doc => {
                    const comment = doc.data();
                    return `
                        <div class="comment-card">
                            <div class="comment-header">
                                <span class="comment-author">${comment.author}</span>
                                <span class="comment-date">${comment.createdAt.toDate().toLocaleDateString('fr-FR')}</span>
                            </div>
                            <div class="comment-content">${comment.text}</div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                container.innerHTML = '<div class="alert alert-danger">Erreur chargement</div>';
            }
        }

        async function loginUser() {
            const phone = document.getElementById('loginPhone').value;
            const password = document.getElementById('loginPassword').value;

            try {
                // Essayer étudiant
                let snapshot = await db.collection('students').where('phone', '==', phone).where('password', '==', password).get();
                let userType = 'student';

                if (snapshot.empty) {
                    // Essayer professeur
                    snapshot = await db.collection('teachers').where('phone', '==', phone).where('password', '==', password).get();
                    userType = 'teacher';
                }

                if (snapshot.empty) {
                    // Essayer admin
                    snapshot = await db.collection('admins').where('phone', '==', phone).where('password', '==', password).get();
                    userType = 'admin';
                }

                if (snapshot.empty) {
                    showAlert('loginAlert', 'Identifiants incorrects', 'danger');
                    return;
                }

                const userDoc = snapshot.docs[0];
                currentUser = { id: userDoc.id, type: userType, ...userDoc.data() };
                
                isLoggedIn = true;
                localStorage.setItem('coverBrainCurrentUser', JSON.stringify(currentUser));
                
                document.getElementById('loginModal').style.display = 'none';
                checkLoginStatus();
                showAlert('formAlert', 'Connexion réussie!', 'success');

                if (userType === 'admin') {
                    showAdminPanel();
                } else {
                    showTab('accueil');
                }

            } catch (error) {
                showAlert('loginAlert', 'Erreur: ' + error.message, 'danger');
            }
        }

        function logoutUser() {
            currentUser = null;
            isLoggedIn = false;
            localStorage.removeItem('coverBrainCurrentUser');
            checkLoginStatus();
            showTab('accueil');
        }

        async function searchTeachers(searchTerm) {
            if (!isLoggedIn) {
                showAlert('formAlert', 'Connectez-vous', 'danger');
                document.getElementById('loginModal').style.display = 'flex';
                return;
            }

            try {
                const snapshot = await db.collection('teachers').get();
                const teachers = [];
                
                snapshot.forEach(doc => {
                    const teacher = { id: doc.id, ...doc.data() };
                    const searchLower = searchTerm.toLowerCase();
                    const matches = teacher.subjects.some(s => s.toLowerCase().includes(searchLower)) ||
                                   teacher.name.toLowerCase().includes(searchLower) ||
                                   teacher.classLevels.some(level => level.toLowerCase().includes(searchLower));
                    
                    if (matches) teachers.push(teacher);
                });

                displaySearchResults(teachers);

            } catch (error) {
                showAlert('formAlert', 'Erreur recherche', 'danger');
            }
        }

        function displaySearchResults(teachers) {
            const container = document.getElementById('resultsContainer');
            
            document.getElementById('resultsTitle').textContent = teachers.length > 0 
                ? `${teachers.length} Professeur(s) Trouvé(s)` 
                : 'Aucun professeur trouvé';

            if (teachers.length === 0) {
                container.innerHTML = '<div class="alert alert-info">Aucun résultat</div>';
                return;
            }

            container.innerHTML = teachers.map(teacher => {
                const availableSlots = teacher.maxStudents - teacher.currentStudents;
                const price = currentUser?.level === 'primaire' ? 5 : 7;
                const message = `Bonjour ${teacher.name}%2C%20je%20suis%20intéressé(e)%20par%20vos%20services%20de%20répétition%20sur%20Cover%20Brain.`;

                return `
                    <div class="teacher-card">
                        <h3>${teacher.name}</h3>
                        <div class="teacher-info">
                            <div class="info-item"><i class="fas fa-book"></i><span>${teacher.subjects.join(', ')}</span></div>
                            <div class="info-item"><i class="fas fa-graduation-cap"></i><span>${teacher.classLevels.join(', ')}</span></div>
                            <div class="info-item"><i class="fas fa-map-marker-alt"></i><span>${teacher.address}</span></div>
                            <div class="info-item"><i class="fas fa-users"></i><span>${availableSlots} places</span></div>
                        </div>
                        <div class="price-tag">${price}$/séance</div>
                        <div class="teacher-actions">
                            <button class="btn btn-success invite-teacher" data-teacher-id="${teacher.id}">
                                <i class="fas fa-user-plus"></i> Inviter
                            </button>
                            <a href="https://wa.me/${teacher.phone}?text=${message}" class="btn btn-whatsapp" target="_blank">
                                <i class="fab fa-whatsapp"></i> WhatsApp
                            </a>
                        </div>
                    </div>
                `;
            }).join('');

            document.querySelectorAll('.invite-teacher').forEach(button => {
                button.addEventListener('click', function() {
                    const teacherId = this.getAttribute('data-teacher-id');
                    inviteTeacher(teacherId);
                });
            });

            document.getElementById('resultsSection').classList.remove('hidden');
        }

        async function inviteTeacher(teacherId) {
            if (!currentUser) return;

            try {
                const exists = await db.collection('invitations')
                    .where('studentId', '==', currentUser.id)
                    .where('teacherId', '==', teacherId)
                    .get();

                if (!exists.empty) {
                    showAlert('formAlert', 'Invitation déjà envoyée', 'warning');
                    return;
                }

                const teacherDoc = await db.collection('teachers').doc(teacherId).get();
                const teacher = teacherDoc.data();

                await db.collection('invitations').add({
                    studentId: currentUser.id,
                    teacherId: teacherId,
                    studentName: currentUser.name,
                    teacherName: teacher.name,
                    studentPhone: currentUser.phone,
                    teacherPhone: teacher.phone,
                    studentAddress: currentUser.address,
                    teacherAddress: teacher.address,
                    subjects: teacher.subjects,
                    level: currentUser.level,
                    price: currentUser.level === 'primaire' ? 5 : 7,
                    status: 'pending',
                    createdAt: new Date()
                });

                showAlert('formAlert', 'Invitation envoyée!', 'success');

            } catch (error) {
                showAlert('formAlert', 'Erreur envoi', 'danger');
            }
        }

        async function showCart() {
            const container = document.getElementById('cartContainer');
            if (!currentUser) {
                container.innerHTML = '<div class="alert alert-info">Connectez-vous</div>';
                return;
            }

            try {
                if (currentUser.type === 'student') {
                    await displayStudentCart();
                } else if (currentUser.type === 'teacher') {
                    await displayTeacherCart();
                }
            } catch (error) {
                container.innerHTML = '<div class="alert alert-danger">Erreur</div>';
            }
        }

        async function displayStudentCart() {
            const container = document.getElementById('cartContainer');
            try {
                const snapshot = await db.collection('invitations')
                    .where('studentId', '==', currentUser.id)
                    .orderBy('createdAt', 'desc')
                    .get();

                if (snapshot.empty) {
                    container.innerHTML = '<div class="alert alert-info">Aucune invitation</div>';
                    return;
                }

                container.innerHTML = `
                    <div class="cart-items">
                        ${snapshot.docs.map(doc => {
                            const inv = doc.data();
                            const message = `Bonjour ${inv.teacherName}%2C%20je%20suis%20intéressé(e)%20par%20vos%20services%20de%20répétition.`;
                            
                            return `
                                <div class="cart-item ${inv.status}">
                                    <div class="status-dot ${inv.status}"></div>
                                    <h4>${inv.teacherName}</h4>
                                    <p><strong>Matières:</strong> ${inv.subjects.join(', ')}</p>
                                    <p><strong>Statut:</strong> ${inv.status === 'pending' ? '⏳ En attente' : inv.status === 'accepted' ? '✅ Accepté' : '❌ Refusé'}</p>
                                    ${inv.status === 'accepted' ? `
                                        <div class="contact-info">
                                            <a href="https://wa.me/${inv.teacherPhone}?text=${message}" class="btn btn-whatsapp" target="_blank">
                                                <i class="fab fa-whatsapp"></i> Contacter sur WhatsApp
                                            </a>
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;

            } catch (error) {
                container.innerHTML = '<div class="alert alert-danger">Erreur</div>';
            }
        }

        async function displayTeacherCart() {
            const container = document.getElementById('cartContainer');
            try {
                const snapshot = await db.collection('invitations')
                    .where('teacherId', '==', currentUser.id)
                    .orderBy('createdAt', 'desc')
                    .get();

                if (snapshot.empty) {
                    container.innerHTML = '<div class="alert alert-info">Aucune demande</div>';
                    return;
                }

                container.innerHTML = `
                    <div class="cart-items">
                        ${snapshot.docs.map(doc => {
                            const inv = doc.data();
                            return `
                                <div class="cart-item ${inv.status}">
                                    <div class="status-dot ${inv.status}"></div>
                                    <h4>${inv.studentName}</h4>
                                    <p><strong>Niveau:</strong> ${inv.level}</p>
                                    <p><strong>Téléphone:</strong> ${inv.studentPhone}</p>
                                    <div class="cart-item-actions">
                                        ${inv.status === 'pending' ? `
                                            <button class="btn btn-success" onclick="updateInvitationStatus('${doc.id}', 'accepted')">Accepter</button>
                                            <button class="btn btn-danger" onclick="updateInvitationStatus('${doc.id}', 'rejected')">Refuser</button>
                                        ` : `
                                            <button class="btn btn-${inv.status === 'accepted' ? 'success' : 'danger'}" disabled>
                                                ${inv.status === 'accepted' ? '✅ Accepté' : '❌ Refusé'}
                                            </button>
                                        `}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;

            } catch (error) {
                container.innerHTML = '<div class="alert alert-danger">Erreur</div>';
            }
        }

        async function updateInvitationStatus(invitationId, status) {
            try {
                await db.collection('invitations').doc(invitationId).update({
                    status: status,
                    respondedAt: new Date()
                });
                showCart();
                showAlert('formAlert', `Invitation ${status === 'accepted' ? 'acceptée' : 'refusée'}`, 'success');
            } catch (error) {
                showAlert('formAlert', 'Erreur', 'danger');
            }
        }

        function showProfile() {
            const container = document.getElementById('profileFormContainer');
            if (!currentUser) {
                container.innerHTML = '<div class="alert alert-info">Connectez-vous</div>';
                return;
            }
            container.innerHTML = `
                <div class="alert alert-info">
                    <strong>${currentUser.name}</strong><br>
                    ${currentUser.phone} • ${currentUser.type}<br>
                    ${currentUser.address}
                </div>
            `;
        }

        function checkLoginStatus() {
            if (isLoggedIn && currentUser) {
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userNavItem').classList.remove('hidden');
                document.getElementById('logoutNavItem').classList.remove('hidden');
                document.getElementById('loginNavItem').classList.add('hidden');
            } else {
                document.getElementById('userNavItem').classList.add('hidden');
                document.getElementById('logoutNavItem').classList.add('hidden');
                document.getElementById('loginNavItem').classList.remove('hidden');
            }
        }

        // ===== FONCTIONS ADMIN RAPIDES =====
        function showAdminPanel() {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('adminSection').classList.remove('hidden');
            loadAdminPanel();
        }

        async function loadAdminPanel() {
            if (!currentUser || currentUser.type !== 'admin') return;

            try {
                const [students, teachers, invitations, comments] = await Promise.all([
                    db.collection('students').get(),
                    db.collection('teachers').get(),
                    db.collection('invitations').get(),
                    db.collection('comments').get()
                ]);

                // Stats
                document.getElementById('totalUsers').textContent = students.size + teachers.size;
                document.getElementById('totalStudents').textContent = students.size;
                document.getElementById('totalTeachers').textContent = teachers.size;
                document.getElementById('totalInvitations').textContent = invitations.size;

                // Utilisateurs
                const usersList = document.getElementById('usersList');
                usersList.innerHTML = '';

                students.forEach(doc => {
                    const user = doc.data();
                    usersList.innerHTML += `
                        <div class="user-item ${user.banned ? 'banned' : ''}">
                            <div>${user.name} • ${user.phone} • Élève</div>
                            <div class="user-actions">
                                <button class="btn btn-${user.banned ? 'success' : 'danger'} btn-sm" 
                                        onclick="${user.banned ? 'unbanUser' : 'banUser'}('${doc.id}', 'student')">
                                    ${user.banned ? 'Débannir' : 'Bannir'}
                                </button>
                            </div>
                        </div>
                    `;
                });

                teachers.forEach(doc => {
                    const user = doc.data();
                    usersList.innerHTML += `
                        <div class="user-item ${user.banned ? 'banned' : ''}">
                            <div>${user.name} • ${user.phone} • Professeur</div>
                            <div class="user-actions">
                                <button class="btn btn-${user.banned ? 'success' : 'danger'} btn-sm" 
                                        onclick="${user.banned ? 'unbanUser' : 'banUser'}('${doc.id}', 'teacher')">
                                    ${user.banned ? 'Débannir' : 'Bannir'}
                                </button>
                            </div>
                        </div>
                    `;
                });

                // Commentaires
                const commentsList = document.getElementById('adminCommentsList');
                commentsList.innerHTML = comments.docs.map(doc => {
                    const comment = doc.data();
                    return `
                        <div class="comment-item">
                            <div><strong>${comment.author}</strong><br>${comment.text}</div>
                            <div class="comment-actions">
                                <button class="btn btn-danger btn-sm" onclick="deleteComment('${doc.id}')">Supprimer</button>
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Erreur admin:', error);
            }
        }

        async function banUser(userId, userType) {
            if (!confirm('Bannir cet utilisateur?')) return;
            try {
                await db.collection(userType + 's').doc(userId).update({ banned: true });
                loadAdminPanel();
            } catch (error) {
                showAlert('formAlert', 'Erreur bannissement', 'danger');
            }
        }

        async function unbanUser(userId, userType) {
            try {
                await db.collection(userType + 's').doc(userId).update({ banned: false });
                loadAdminPanel();
            } catch (error) {
                showAlert('formAlert', 'Erreur débannissement', 'danger');
            }
        }

        async function deleteComment(commentId) {
            if (!confirm('Supprimer ce commentaire?')) return;
            try {
                await db.collection('comments').doc(commentId).delete();
                loadAdminPanel();
                loadComments();
            } catch (error) {
                showAlert('formAlert', 'Erreur suppression', 'danger');
            }
        }

        async function savePlatformSettings() {
            showAlert('formAlert', 'Paramètres sauvegardés!', 'success');
        }

        function showAlert(containerId, message, type) {
            const container = document.getElementById(containerId);
            container.textContent = message;
            container.className = `alert alert-${type}`;
            container.classList.remove('hidden');
            setTimeout(() => container.classList.add('hidden'), 4000);
        }

        // Exposer les fonctions globales
        window.showTab = showTab;
        window.showSection = showSection;
        window.logoutUser = logoutUser;
        window.updateInvitationStatus = updateInvitationStatus;
        window.banUser = banUser;
        window.unbanUser = unbanUser;
        window.deleteComment = deleteComment;
        window.savePlatformSettings = savePlatformSettings;
        window.showAdminPanel = showAdminPanel;
    </script>
</body>
</html>